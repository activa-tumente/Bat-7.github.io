var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,n=(e,s)=>{for(var a in s||(s={}))i.call(s,a)&&l(e,a,s[a]);if(t)for(var a of t(s))r.call(s,a)&&l(e,a,s[a]);return e},o=(e,t)=>s(e,a(t)),c=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{n(a.next(e))}catch(s){i(s)}},l=e=>{try{n(a.throw(e))}catch(s){i(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,l);n((a=a.apply(e,s)).next())});import{r as d,m,B as x,a3 as u,a4 as p,j as g,D as h,a5 as b,a6 as f,h as j,I as y,J as N,T as v,a7 as w,Q as C,M as k,C as P,a8 as _,a9 as S,H as A,G as E,aa as L,z as U,F as $,w as T,ab as D,ac as I,l as z,t as O,ad as M,e as R,ae as G,f as B,s as F,a as H}from"./vendor-DFW_gwso.js";import{u as q}from"./index-C5yEVYWS.js";import{P as J}from"./PageHeader-Yn2bRdE6.js";import{p as V,s as K}from"./PinManagementService-B1vYcuHx.js";import{p as X,P as W}from"./ImprovedPinControlService-CSzffYra.js";const Y=({title:e,value:s,icon:a,color:t,percentage:i,trend:r,subtitle:l})=>g.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:e}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s}),l&&g.jsx("p",{className:"text-xs text-gray-500 mt-1",children:l})]}),g.jsx("div",{className:"flex-shrink-0",children:g.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white",style:{backgroundColor:t},children:g.jsx(a,{className:"w-6 h-6"})})})]}),i&&g.jsxs("div",{className:"mt-4 flex items-center",children:[g.jsxs("span",{className:"text-sm font-medium px-2 py-1 rounded "+("up"===r?"text-green-700 bg-green-100":"text-red-700 bg-red-100"),children:["up"===r?"+":"",i,"%"]}),g.jsx("span",{className:"text-sm text-gray-500 ml-2",children:l||"vs sem. anterior"})]})]}),Z=()=>{const[e,s]=d.useState({totalUsers:20,todayActions:6,newUsers:0,completedTests:30}),[a,t]=d.useState(!1),i=[{title:"Usuarios Totales",value:e.totalUsers,icon:m,color:"#3B82F6",percentage:12,trend:"up",subtitle:"vs ayer"},{title:"Acciones Hoy",value:e.todayActions,icon:x,color:"#10B981",percentage:12,trend:"up",subtitle:"vs ayer"},{title:"Nuevos (7 d√≠as)",value:e.newUsers,icon:u,color:"#3B82F6",percentage:-33,trend:"down",subtitle:"vs sem. anterior"},{title:"Tests Completados",value:e.completedTests,icon:p,color:"#F59E0B",percentage:5,trend:"up",subtitle:"este mes"}],r=[{id:1,type:"Nuevo usuario registrado",user:"admin@maci.com",time:"Hace 15m",icon:u,color:"#10B981"},{id:2,type:"Test MACI-II completado",user:"paciente@test.com",time:"Hace 1h",icon:p,color:"#F59E0B"},{id:3,type:"Rol de usuario actualizado",user:"admin@maci.com",time:"Hace 2h",icon:h,color:"#6366F1"}];return a?g.jsxs("div",{className:"flex items-center justify-center h-64",children:[g.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),g.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando..."})]}):g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Dashboard de Administraci√≥n"}),g.jsx("p",{className:"text-gray-600",children:"Resumen general del sistema BAT-7"})]}),g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:i.map((e,s)=>g.jsx(Y,{title:e.title,value:e.value,icon:e.icon,color:e.color,percentage:e.percentage,trend:e.trend,subtitle:e.subtitle},s))}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[g.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actividad de Usuarios (√öltimos 7 d√≠as)"}),g.jsx("div",{className:"h-48 flex items-end justify-between space-x-2",children:[12,8,15,10,6,14,9].map((e,s)=>g.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[g.jsx("div",{className:"w-full bg-gradient-to-t from-blue-500 to-blue-300 rounded-t-lg",style:{height:e/15*100+"%",minHeight:"20px"}}),g.jsx("span",{className:"text-xs text-gray-500 mt-2",children:["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"][s]})]},s))})]}),g.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actividad Reciente"}),g.jsx("div",{className:"space-y-4",children:r.map(e=>{const s=e.icon;return g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white flex-shrink-0",style:{backgroundColor:e.color},children:g.jsx(s,{className:"w-4 h-4"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.type}),g.jsx("p",{className:"text-sm text-gray-500 truncate",children:e.user})]}),g.jsx("div",{className:"text-sm text-gray-500",children:e.time})]},e.id)})})]})]})]})},Q=()=>{const[e,s]=d.useState([{id:1,nombre:"Juan",apellido:"P√©rez",email:"juan.perez@test.com",documento:"12345678",tipo_usuario:"candidato",activo:!0,fecha_creacion:"2025-07-15"},{id:2,nombre:"Mar√≠a",apellido:"Garc√≠a",email:"maria.garcia@test.com",documento:"87654321",tipo_usuario:"psicologo",activo:!0,fecha_creacion:"2025-07-14"},{id:3,nombre:"Admin",apellido:"Sistema",email:"admin@bat7.com",documento:"11111111",tipo_usuario:"administrador",activo:!0,fecha_creacion:"2025-07-10"}]),[a,t]=d.useState(""),[i,r]=d.useState("all"),[l,c]=d.useState(!1),[x,p]=d.useState(null),[h,v]=d.useState(!1),w=e.filter(e=>{var s,t,r,l;const n=(null==(s=e.nombre)?void 0:s.toLowerCase().includes(a.toLowerCase()))||(null==(t=e.apellido)?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null==(r=e.email)?void 0:r.toLowerCase().includes(a.toLowerCase()))||(null==(l=e.documento)?void 0:l.includes(a)),o="all"===i||e.tipo_usuario===i;return n&&o}),C={total:e.length,active:e.filter(e=>!0===e.activo).length,inactive:e.filter(e=>!1===e.activo).length},k=e=>{switch(null==e?void 0:e.toLowerCase()){case"administrador":return"bg-red-100 text-red-800";case"psicologo":return"bg-blue-100 text-blue-800";case"candidato":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"text-center mb-6",children:[g.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gesti√≥n de Usuarios"}),g.jsx("p",{className:"text-gray-600 mt-2",children:"Administra usuarios del sistema"})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[g.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:g.jsxs("div",{className:"flex items-center",children:[g.jsx("div",{className:"p-3 rounded-full bg-blue-100 mr-4",children:g.jsx(m,{className:"w-6 h-6 text-blue-600"})}),g.jsxs("div",{children:[g.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.total}),g.jsx("p",{className:"text-gray-600",children:"Total Usuarios"})]})]})}),g.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:g.jsxs("div",{className:"flex items-center",children:[g.jsx("div",{className:"p-3 rounded-full bg-green-100 mr-4",children:g.jsx(b,{className:"w-6 h-6 text-green-600"})}),g.jsxs("div",{children:[g.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.active}),g.jsx("p",{className:"text-gray-600",children:"Usuarios Activos"})]})]})}),g.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:g.jsxs("div",{className:"flex items-center",children:[g.jsx("div",{className:"p-3 rounded-full bg-red-100 mr-4",children:g.jsx(f,{className:"w-6 h-6 text-red-600"})}),g.jsxs("div",{children:[g.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.inactive}),g.jsx("p",{className:"text-gray-600",children:"Usuarios Inactivos"})]})]})})]}),g.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[g.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[g.jsx("div",{className:"flex-1",children:g.jsxs("div",{className:"relative",children:[g.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),g.jsx("input",{type:"text",placeholder:"Buscar usuarios...",value:a,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),g.jsxs("select",{value:i,onChange:e=>r(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[g.jsx("option",{value:"all",children:"Todos los roles"}),g.jsx("option",{value:"administrador",children:"Administrador"}),g.jsx("option",{value:"psicologo",children:"Psic√≥logo"}),g.jsx("option",{value:"candidato",children:"Candidato"})]}),g.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",onClick:()=>c(!0),children:[g.jsx(u,{}),g.jsx("span",{children:"Nuevo Usuario"})]})]}),g.jsx("div",{className:"overflow-x-auto",children:g.jsxs("table",{className:"min-w-full",children:[g.jsx("thead",{children:g.jsxs("tr",{className:"border-b border-gray-200",children:[g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Usuario"}),g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Email"}),g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Documento"}),g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Rol"}),g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Estado"}),g.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Acciones"})]})}),g.jsx("tbody",{children:w.map(a=>{return g.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[g.jsx("td",{className:"py-3 px-4",children:g.jsxs("div",{children:[g.jsxs("div",{className:"font-medium text-gray-900",children:[a.nombre," ",a.apellido]}),g.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.id]})]})}),g.jsx("td",{className:"py-3 px-4 text-gray-600",children:a.email}),g.jsx("td",{className:"py-3 px-4 text-gray-600",children:a.documento}),g.jsx("td",{className:"py-3 px-4",children:g.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${k(a.tipo_usuario)}`,children:a.tipo_usuario})}),g.jsx("td",{className:"py-3 px-4",children:g.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+(t=a.activo,!0===t||"active"===t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:a.activo?"Activo":"Inactivo"})}),g.jsx("td",{className:"py-3 px-4",children:g.jsxs("div",{className:"flex space-x-2",children:[g.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-100 rounded",onClick:()=>(e=>{p(e),v(!0)})(a),title:"Editar usuario",children:g.jsx(y,{className:"w-4 h-4"})}),g.jsx("button",{className:"p-2 text-red-600 hover:bg-red-100 rounded",onClick:()=>{return t=a.id,void(window.confirm("¬øEst√° seguro de que desea eliminar este usuario?")&&s(e.filter(e=>e.id!==t)));var t},title:"Eliminar usuario",children:g.jsx(N,{className:"w-4 h-4"})})]})})]},a.id);var t})})]})}),0===w.length&&g.jsx("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron usuarios que coincidan con los criterios de b√∫squeda."})]}),l&&g.jsx(ee,{isOpen:l,onClose:()=>c(!1),onSave:a=>{const t=o(n({id:Math.max(...e.map(e=>e.id))+1},a),{fecha_creacion:(new Date).toISOString().split("T")[0],activo:!0});s([...e,t]),c(!1)},title:"Crear Nuevo Usuario"}),h&&g.jsx(ee,{isOpen:h,onClose:()=>v(!1),onSave:a=>{s(e.map(e=>e.id===x.id?n(n({},e),a):e)),v(!1),p(null)},title:"Editar Usuario",initialData:x})]})},ee=({isOpen:e,onClose:s,onSave:a,title:t,initialData:i=null})=>{const[r,l]=d.useState({nombre:(null==i?void 0:i.nombre)||"",apellido:(null==i?void 0:i.apellido)||"",email:(null==i?void 0:i.email)||"",documento:(null==i?void 0:i.documento)||"",tipo_usuario:(null==i?void 0:i.tipo_usuario)||"candidato"});return e?g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[g.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),g.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.nombre&&r.apellido&&r.email&&r.documento&&(a(r),l({nombre:"",apellido:"",email:"",documento:"",tipo_usuario:"candidato"}))},className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),g.jsx("input",{type:"text",value:r.nombre,onChange:e=>l(o(n({},r),{nombre:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido"}),g.jsx("input",{type:"text",value:r.apellido,onChange:e=>l(o(n({},r),{apellido:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),g.jsx("input",{type:"email",value:r.email,onChange:e=>l(o(n({},r),{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documento"}),g.jsx("input",{type:"text",value:r.documento,onChange:e=>l(o(n({},r),{documento:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Usuario"}),g.jsxs("select",{value:r.tipo_usuario,onChange:e=>l(o(n({},r),{tipo_usuario:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[g.jsx("option",{value:"candidato",children:"Candidato"}),g.jsx("option",{value:"psicologo",children:"Psic√≥logo"}),g.jsx("option",{value:"administrador",children:"Administrador"})]})]}),g.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[g.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancelar"}),g.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:i?"Actualizar":"Crear"})]})]})]})}):null},se=()=>{const[e,s]=d.useState(""),[a,t]=d.useState(!1),[i,r]=d.useState([{id:1,name:"Inicio",path:"/home",description:"P√°gina principal del sistema",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!0},specificUsers:["U1","U2"]},{id:2,name:"Cuestionario",path:"/cuestionario",description:"Evaluaciones psicol√≥gicas BAT-7",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!0},specificUsers:[]},{id:3,name:"Resultados",path:"/resultados",description:"Visualizaci√≥n de resultados de evaluaciones",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!1},specificUsers:[]},{id:4,name:"Informes",path:"/informes",description:"Generaci√≥n y gesti√≥n de informes",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!1},specificUsers:[]},{id:5,name:"Administraci√≥n",path:"/admin/administration",description:"Panel de administraci√≥n del sistema",status:"Activa",permissions:{administrador:!0,psicologo:!1,candidato:!1},specificUsers:[]},{id:6,name:"Configuraci√≥n",path:"/configuracion",description:"Configuraci√≥n del sistema",status:"Activa",permissions:{administrador:!0,psicologo:!1,candidato:!1},specificUsers:[]},{id:7,name:"Pacientes",path:"/pacientes",description:"Gesti√≥n de pacientes",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!1},specificUsers:[]},{id:8,name:"Soporte",path:"/soporte",description:"Centro de ayuda y soporte t√©cnico",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!0},specificUsers:[]},{id:9,name:"Ayuda",path:"/ayuda",description:"Documentaci√≥n y gu√≠as de usuario",status:"Activa",permissions:{administrador:!0,psicologo:!0,candidato:!0},specificUsers:[]}]),l=i.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())||s.path.toLowerCase().includes(e.toLowerCase())),c=(e,s)=>{switch(e){case"administrador":return"bg-blue-500";case"psicologo":return"bg-green-500";case"candidato":return"bg-orange-500";default:return"bg-gray-500"}};return g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:g.jsx(m,{className:"w-5 h-5 text-blue-600"})}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Control de Acceso a P√°ginas"}),g.jsx("p",{className:"text-gray-600",children:"Gestiona qu√© roles pueden acceder a cada p√°gina del sistema. Los cambios se aplican inmediatamente."})]})]}),g.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:g.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[g.jsxs("div",{className:"flex-1 relative",children:[g.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),g.jsx("input",{type:"text",placeholder:"Buscar rutas por nombre o path...",value:e,onChange:e=>s(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),g.jsxs("button",{onClick:()=>t(!a),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center space-x-2",children:[g.jsx(v,{className:"w-4 h-4"}),g.jsx("span",{children:"Filtros Avanzados"})]})]})}),g.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[g.jsx("div",{className:"bg-blue-600 text-white",children:g.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 font-medium",children:[g.jsx("div",{className:"col-span-2",children:"P√°gina"}),g.jsx("div",{className:"col-span-2",children:"Estado"}),g.jsx("div",{className:"col-span-2 text-center",children:"üëë Administrador"}),g.jsx("div",{className:"col-span-2 text-center",children:"üë®‚Äç‚öïÔ∏è Psic√≥logo"}),g.jsx("div",{className:"col-span-2 text-center",children:"üéì Candidato"}),g.jsx("div",{className:"col-span-1 text-center",children:"üë• Usuarios Espec√≠ficos"}),g.jsx("div",{className:"col-span-1 text-center",children:"Info"})]})}),g.jsx("div",{className:"divide-y divide-gray-200",children:l.map(e=>g.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 hover:bg-gray-50",children:[g.jsxs("div",{className:"col-span-2",children:[g.jsx("div",{className:"font-medium text-gray-900",children:e.name}),g.jsx("div",{className:"text-sm text-gray-500",children:e.path}),g.jsx("div",{className:"text-xs text-gray-400",children:e.description})]}),g.jsx("div",{className:"col-span-2 flex items-center",children:g.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("Activa"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status})}),["administrador","psicologo","candidato"].map(s=>g.jsx("div",{className:"col-span-2 flex justify-center",children:g.jsx("button",{onClick:()=>((e,s)=>{r(i.map(a=>a.id===e?o(n({},a),{permissions:o(n({},a.permissions),{[s]:!a.permissions[s]})}):a))})(e.id,s),className:`w-12 h-6 rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${e.permissions[s]?c(s):"bg-gray-300"}`,children:g.jsx("div",{className:"w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 ease-in-out "+(e.permissions[s]?"translate-x-6":"translate-x-0.5")})})},s)),g.jsx("div",{className:"col-span-1 flex justify-center",children:g.jsxs("button",{className:"px-3 py-1 text-xs bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200",children:["üë• ",e.specificUsers.length," usuario(s)"]})}),g.jsx("div",{className:"col-span-1 flex justify-center",children:g.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600",children:g.jsx(w,{className:"w-4 h-4"})})})]},e.id))})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[g.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[g.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.length}),g.jsx("div",{className:"text-sm text-gray-600",children:"Total de P√°ginas"})]}),g.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[g.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.filter(e=>"Activa"===e.status).length}),g.jsx("div",{className:"text-sm text-gray-600",children:"P√°ginas Activas"})]}),g.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[g.jsx("div",{className:"text-2xl font-bold text-orange-600",children:i.filter(e=>e.permissions.candidato).length}),g.jsx("div",{className:"text-sm text-gray-600",children:"Accesibles a Candidatos"})]}),g.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[g.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.filter(e=>e.specificUsers.length>0).length}),g.jsx("div",{className:"text-sm text-gray-600",children:"Con Usuarios Espec√≠ficos"})]})]})]})},ae=()=>{const[e,s]=d.useState([]),[a,t]=d.useState([]),[i,r]=d.useState([]),[l,m]=d.useState(!0),[x,u]=d.useState(""),[p,h]=d.useState(""),[b,f]=d.useState([]),[y,N]=d.useState(!1),[v,w]=d.useState([]),[U,$]=d.useState("");d.useEffect(()=>{T()},[]);const T=()=>c(null,null,function*(){try{m(!0),D(),I(),z()}catch(e){C.error("Error al cargar datos")}finally{m(!1)}}),D=()=>{s([{id:"1",nombre:"Dr. Rodriguez",apellido:"Mart√≠nez",email:"dr.rodriguez@bat7.com",tipo_usuario:"psicologo",especialidad:"Psicolog√≠a Cl√≠nica"},{id:"2",nombre:"Dra. Mart√≠nez",apellido:"L√≥pez",email:"dra.martinez@bat7.com",tipo_usuario:"psicologo",especialidad:"Psicolog√≠a Educativa"},{id:"3",nombre:"Dr. Garc√≠a",apellido:"Fern√°ndez",email:"dr.garcia@bat7.com",tipo_usuario:"psicologo",especialidad:"Psicolog√≠a Organizacional"}])},I=()=>{t([{id:"3",nombre:"Juan",apellido:"P√©rez",email:"juan.perez@test.com",tipo_usuario:"candidato",documento:"12345678"},{id:"4",nombre:"Mar√≠a",apellido:"Garc√≠a",email:"maria.garcia@test.com",tipo_usuario:"candidato",documento:"87654321"},{id:"5",nombre:"Carlos",apellido:"L√≥pez",email:"carlos.lopez@test.com",tipo_usuario:"candidato",documento:"11223344"},{id:"6",nombre:"Ana",apellido:"Mart√≠nez",email:"ana.martinez@test.com",tipo_usuario:"candidato",documento:"44332211"}])},z=()=>{r([{id:1,psicologo_id:"1",paciente_id:"3",assigned_at:"2025-07-15T10:30:00Z",is_active:!0,psychologist:{id:"1",nombre:"Dr. Rodriguez",apellido:"Mart√≠nez",email:"dr.rodriguez@bat7.com"},patient:{id:"3",nombre:"Juan",apellido:"P√©rez",email:"juan.perez@test.com"}},{id:2,psicologo_id:"2",paciente_id:"4",assigned_at:"2025-07-14T14:20:00Z",is_active:!0,psychologist:{id:"2",nombre:"Dra. Mart√≠nez",apellido:"L√≥pez",email:"dra.martinez@bat7.com"},patient:{id:"4",nombre:"Mar√≠a",apellido:"Garc√≠a",email:"maria.garcia@test.com"}}])},O=()=>{const e=i.filter(e=>!0===e.is_active).map(e=>e.paciente_id);return a.filter(s=>!e.includes(s.id))},M=e.filter(e=>{var s,a,t;return(null==(s=e.nombre)?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null==(a=e.apellido)?void 0:a.toLowerCase().includes(x.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(x.toLowerCase()))});return l?g.jsx("div",{className:"flex justify-center items-center h-64",children:g.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"text-center mb-6",children:[g.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Asignaci√≥n de Pacientes"}),g.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona la asignaci√≥n de pacientes a psic√≥logos"})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[g.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Psic√≥logos"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:e.length})]}),g.jsx(k,{className:"w-8 h-8 text-blue-500"})]})}),g.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pacientes"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.length})]}),g.jsx(P,{className:"w-8 h-8 text-green-500"})]})}),g.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Asignaciones"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:i.filter(e=>"active"===e.status).length})]}),g.jsx(_,{className:"w-8 h-8 text-orange-500"})]})}),g.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Sin Asignar"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:O().length})]}),g.jsx(S,{className:"w-8 h-8 text-red-500"})]})})]}),g.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0 mb-6",children:[g.jsxs("div",{className:"relative",children:[g.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),g.jsx("input",{type:"text",placeholder:"Buscar psic√≥logos...",value:x,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),g.jsxs("button",{onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[g.jsx(A,{}),g.jsx("span",{children:"Nueva Asignaci√≥n"})]})]}),g.jsx("div",{className:"space-y-6",children:M.map(e=>{const s=(t=e.id,i.filter(e=>e.psicologo_id===t&&!0===e.is_active).map(e=>{const s=a.find(s=>s.id===e.paciente_id);return o(n({},e),{patient:s})}).filter(e=>e.patient));var t;return g.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:g.jsx(k,{className:"w-5 h-5 text-blue-600"})}),g.jsxs("div",{children:[g.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[e.nombre," ",e.apellido]}),g.jsx("p",{className:"text-sm text-gray-600",children:e.email})]})]}),g.jsxs("div",{className:"text-right",children:[g.jsx("p",{className:"text-sm text-gray-600",children:"Pacientes asignados"}),g.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.length})]})]}),s.length>0?g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>g.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:g.jsx(P,{className:"w-4 h-4 text-green-600"})}),g.jsxs("div",{children:[g.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.patient.nombre," ",e.patient.apellido]}),g.jsx("p",{className:"text-xs text-gray-600",children:e.patient.email})]})]}),g.jsx("button",{onClick:()=>{return s=e.id,c(null,null,function*(){if(window.confirm("¬øEst√°s seguro de que quieres desasignar este paciente?"))try{r(e=>e.filter(e=>e.id!==s));const{error:e}=yield supabase.from("patient_assignments").delete().eq("id",s);if(e&&"42P01"!==e.code)throw e;C.success("Paciente desasignado exitosamente")}catch(e){C.error("Error al desasignar paciente")}});var s},className:"text-red-600 hover:text-red-900 p-1",title:"Desasignar paciente",children:g.jsx(E,{})})]},e.id))}):g.jsxs("div",{className:"text-center py-8 text-gray-500",children:[g.jsx(P,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),g.jsx("p",{children:"No hay pacientes asignados"})]})]},e.id)})}),0===M.length&&g.jsx("div",{className:"text-center py-8",children:g.jsx("p",{className:"text-gray-500",children:"No se encontraron psic√≥logos"})})]}),y&&g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Nueva Asignaci√≥n"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Psic√≥logo"}),g.jsxs("select",{value:p,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[g.jsx("option",{value:"",children:"Seleccionar psic√≥logo"}),e.map(e=>g.jsxs("option",{value:e.id,children:[e.nombre," ",e.apellido]},e.id))]})]}),g.jsxs("div",{children:[g.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Pacientes sin asignar (",O().filter(e=>e.nombre.toLowerCase().includes(U.toLowerCase())||e.apellido.toLowerCase().includes(U.toLowerCase())||e.email.toLowerCase().includes(U.toLowerCase())).length,")"]}),g.jsxs("div",{className:"relative mb-3",children:[g.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),g.jsx("input",{type:"text",placeholder:"Buscar pacientes...",value:U,onChange:e=>$(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),g.jsxs("div",{className:"max-h-48 overflow-y-auto border border-gray-300 rounded-lg",children:[O().filter(e=>e.nombre.toLowerCase().includes(U.toLowerCase())||e.apellido.toLowerCase().includes(U.toLowerCase())||e.email.toLowerCase().includes(U.toLowerCase())).map(e=>g.jsxs("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-200 last:border-b-0 flex items-center justify-between "+(v.includes(e.id)?"bg-blue-50 border-blue-200":""),onClick:()=>{return s=e.id,void w(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},children:[g.jsxs("div",{className:"flex-1",children:[g.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.nombre," ",e.apellido]}),g.jsx("p",{className:"text-xs text-gray-600",children:e.email})]}),v.includes(e.id)&&g.jsx(L,{className:"w-4 h-4 text-blue-600"})]},e.id)),0===O().filter(e=>e.nombre.toLowerCase().includes(U.toLowerCase())||e.apellido.toLowerCase().includes(U.toLowerCase())||e.email.toLowerCase().includes(U.toLowerCase())).length&&g.jsx("div",{className:"p-4 text-center text-gray-500",children:U?"No se encontraron pacientes":"No hay pacientes sin asignar"})]}),v.length>0&&g.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:[v.length," paciente(s) seleccionado(s)"]})]})]}),g.jsxs("div",{className:"flex space-x-2 mt-6",children:[g.jsx("button",{onClick:()=>{N(!1),w([]),h(""),$("")},className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Cancelar"}),g.jsxs("button",{onClick:()=>c(null,null,function*(){if(p&&0!==v.length)try{const e=v.map(e=>({id:`${p}-${e}-${Date.now()}`,psicologo_id:p,paciente_id:e,assigned_at:(new Date).toISOString(),is_active:!0}));r(s=>[...s,...e]),w([]),h(""),$(""),N(!1),C.success(`${v.length} paciente(s) asignado(s) exitosamente`)}catch(e){C.error("Error al guardar asignaciones")}else C.error("Debe seleccionar un psic√≥logo y al menos un paciente")}),disabled:!p||0===v.length,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2",children:[g.jsx(L,{className:"w-4 h-4"}),g.jsxs("span",{children:["Guardar (",v.length,")"]})]})]})]})})]})},te=({isOpen:e,onClose:s,onSuccess:a})=>{const[t,i]=d.useState(!1),{psychologists:r,loading:l,error:n}=(()=>{const[e,s]=d.useState([]),[a,t]=d.useState(!1),[i,r]=d.useState(null),l=d.useCallback(()=>c(null,null,function*(){try{t(!0),r(null);const e=(yield X.getAllPsychologists()).map(e=>{var s,a;return{id:e.psychologist_id,nombre:(null==(s=e.psychologist_name)?void 0:s.split(" ")[0])||"",apellido:(null==(a=e.psychologist_name)?void 0:a.split(" ").slice(1).join(" "))||"",email:e.psychologist_email,currentPins:e.remaining_pins,hasControl:e.has_control}});s(e)}catch(e){r("Error al cargar la lista de psic√≥logos"),C.error("Error al cargar la lista de psic√≥logos")}finally{t(!1)}}),[]);return d.useEffect(()=>{l()},[l]),{psychologists:e,loading:a,error:i,refetch:l}})(),{selectedPsychologist:o,pinAmount:m,pinOptions:x,validation:u,setSelectedPsychologist:p,setPinAmount:h,handlePinOptionClick:b,resetForm:f,getFormData:j}=(()=>{const[e,s]=d.useState(""),[a,t]=d.useState(""),[i,r]=d.useState(!1),l=d.useMemo(()=>[1,5,25,50,100,W.THRESHOLDS.BULK_ASSIGNMENT_MIN,W.THRESHOLDS.BULK_ASSIGNMENT_MAX],[]),n=d.useMemo(()=>{const s=[];if(e||s.push("Debe seleccionar un psic√≥logo"),!i){const e=parseInt(a);!a||e<=0?s.push("Debe ingresar una cantidad v√°lida de pines"):e>W.THRESHOLDS.BULK_ASSIGNMENT_MAX&&s.push(`La cantidad m√°xima es ${W.THRESHOLDS.BULK_ASSIGNMENT_MAX} pines`)}return{isValid:0===s.length,errors:s}},[e,a,i]),o=d.useCallback(e=>{t(e.toString())},[]),c=d.useCallback(()=>{s(""),t(""),r(!1)},[]),m=d.useCallback(()=>({psychologistId:e,amount:i?0:parseInt(a),isUnlimited:i,planType:i?W.PLAN_TYPES.UNLIMITED:W.PLAN_TYPES.ASSIGNED}),[e,a,i]);return{selectedPsychologist:e,pinAmount:a,isUnlimited:i,pinOptions:l,validation:n,setSelectedPsychologist:s,setPinAmount:t,setIsUnlimited:r,handlePinOptionClick:o,resetForm:c,getFormData:m}})();d.useEffect(()=>{e||f()},[e,f]);const y=d.useCallback(()=>c(null,null,function*(){if(u.isValid)try{i(!0);const e=j();yield V.assignPins(e.psychologistId,e.amount,`Asignaci√≥n manual ${e.isUnlimited?"ilimitada":`de ${e.amount} pines`} desde modal`),f(),null==a||a(),s(),C.success(`Pines ${e.isUnlimited?"ilimitados":e.amount} asignados correctamente`)}catch(e){C.error("Error al asignar pines: "+e.message)}finally{i(!1)}else u.errors.forEach(e=>C.warn(e))}),[u,j,f,a,s]),N=d.useCallback(()=>{t||s()},[t,s]);return d.useMemo(()=>r.find(e=>e.id===o),[r,o]),e?g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:g.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4 transform transition-all",children:[g.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:g.jsx(U,{className:"w-6 h-6 text-blue-600"})}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-xl font-bold text-gray-900",id:"modal-title",children:"Asignar Pines"}),g.jsx("p",{className:"text-sm text-gray-500",children:"Gestiona la asignaci√≥n de pines a psic√≥logos"})]})]}),g.jsx("button",{onClick:N,disabled:t,className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Cerrar modal",children:g.jsx(E,{size:20})})]}),g.jsxs("div",{className:"p-6",children:[g.jsxs("div",{className:"mb-6",children:[g.jsx("label",{htmlFor:"psychologist-select",className:"block text-sm font-semibold text-gray-700 mb-3",children:"Seleccionar Psic√≥logo"}),l?g.jsxs("div",{className:"flex items-center justify-center py-3",children:[g.jsx($,{className:"animate-spin text-blue-500 mr-2"}),g.jsx("span",{className:"text-gray-600",children:"Cargando psic√≥logos..."})]}):n?g.jsxs("div",{className:"flex items-center py-3 text-red-600",children:[g.jsx(T,{className:"mr-2"}),g.jsx("span",{className:"text-sm",children:n})]}):g.jsxs("div",{className:"relative",children:[g.jsxs("select",{id:"psychologist-select",value:o,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white appearance-none cursor-pointer transition-all disabled:bg-gray-100",disabled:t,"aria-describedby":"psychologist-help",children:[g.jsx("option",{value:"",children:"Seleccionar psic√≥logo..."}),r.map(e=>g.jsxs("option",{value:e.id,children:[e.nombre," ",e.apellido," - ",e.email,void 0!==e.currentPins&&` (${e.currentPins} pines actuales)`]},e.id))]}),g.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:g.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),g.jsx("p",{id:"psychologist-help",className:"text-xs text-gray-500 mt-1",children:"Selecciona el psic√≥logo al que deseas asignar pines"})]}),g.jsxs("div",{className:"mb-6",children:[g.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Cantidad de Pines"}),g.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:x.map(e=>g.jsx("button",{type:"button",onClick:()=>b(e),className:"px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all transform hover:scale-105 "+(m===e.toString()?"bg-blue-500 text-white border-blue-500 shadow-lg":"bg-white text-gray-700 border-gray-200 hover:bg-blue-50 hover:border-blue-300"),disabled:t,children:e},e))}),g.jsxs("div",{className:"relative",children:[g.jsx("input",{type:"number",min:"1",max:"1000",placeholder:"Cantidad personalizada",value:m,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:t}),g.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:g.jsx(U,{className:"w-4 h-4 text-gray-400"})})]}),m&&parseInt(m)>0&&g.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Pines a asignar:"}),g.jsx("span",{className:"text-lg font-bold text-blue-600",children:m})]})})]}),o&&m&&g.jsx("div",{className:"mb-6 p-3 bg-blue-50 rounded-md border border-blue-200",children:g.jsxs("div",{className:"flex items-center text-blue-800",children:[g.jsx(U,{className:"mr-2"}),g.jsxs("span",{className:"text-sm",children:["Se asignar√°n ",g.jsxs("strong",{children:[m," pines"]})," al psic√≥logo seleccionado"]})]})})]}),g.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50",children:[g.jsx("button",{onClick:N,disabled:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"}),g.jsx("button",{onClick:y,disabled:t||!o||!m,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:bg-gray-400 transition-colors flex items-center",children:t?g.jsxs(g.Fragment,{children:[g.jsx($,{className:"animate-spin mr-2"}),"Asignando..."]}):g.jsxs(g.Fragment,{children:[g.jsx(U,{className:"mr-2"}),"Asignar Pines"]})})]})]})}):null},ie=()=>{const[e,s]=d.useState([]),a=K,[t,i]=d.useState("7days"),[r,l]=d.useState(!0),[n,o]=d.useState([]),[x,u]=d.useState([]),[h,b]=d.useState(""),[j,v]=d.useState(1),[w,k]=d.useState(!1),[P,_]=d.useState(!1),[S,E]=d.useState([]),[L,$]=d.useState(!1),[R,G]=d.useState([]),[B,F]=d.useState(!1),[H,q]=d.useState(!1),[J,X]=d.useState("pins"),[W,Y]=d.useState(1),[Z,Q]=d.useState(!1),ee=d.useMemo(()=>({totalPsychologists:e.length,totalPinsAssigned:e.reduce((e,s)=>e+(s.total_asignado||0),0),totalPinsUsed:e.reduce((e,s)=>e+(s.total_consumido||0),0),totalPinsRemaining:e.reduce((e,s)=>e+(s.pines_restantes||0),0)}),[e]);d.useEffect(()=>{se()},[t]);const se=()=>c(null,null,function*(){try{l(!0);const e=yield V.getPsychologistsWithPinStats();s(e);const a=yield V.getTransactionHistory(null,20);o(a);const t=e.filter(e=>("pocos_pines"===e.status||"sin_pines"===e.status)&&e.total_asignado>0).map(e=>({type:"sin_pines"===e.status?"error":"warning",psychologist_id:e.psicologo_id,psychologist_name:e.nombre_psicologo,message:"sin_pines"===e.status?`${e.nombre_psicologo} no tiene pines disponibles`:`${e.nombre_psicologo} tiene solo ${e.pines_restantes} pines restantes`,severity:"sin_pines"===e.status?"error":"warning"}));u(t)}catch(e){C.error("Error al cargar datos de pines")}finally{l(!1)}}),ae=e=>{switch(e){case"asignacion":case"pin_assigned":return g.jsx(A,{className:"w-4 h-4 text-green-600"});case"consumo":case"pin_consumed":return g.jsx(U,{className:"w-4 h-4 text-orange-600"});case"test_completed":return g.jsx(p,{className:"w-4 h-4 text-blue-600"});case"report_generated":return g.jsx(M,{className:"w-4 h-4 text-purple-600"});default:return g.jsx(m,{className:"w-4 h-4 text-gray-600"})}},ie=e=>{switch(e){case"asignacion":case"pin_assigned":return"bg-green-100 text-green-800";case"consumo":case"pin_consumed":return"bg-orange-100 text-orange-800";case"test_completed":return"bg-blue-100 text-blue-800";case"report_generated":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},re=e=>{switch(e){case"activo":return"bg-green-100 text-green-800";case"pocos_pines":return"bg-yellow-100 text-yellow-800";case"sin_pines":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},le=e=>{switch(e){case"activo":return"Activo";case"pocos_pines":return"Pines Bajos";case"sin_pines":return"Sin Pines";default:return"Inactivo"}},ne=e=>{const s=new Date,a=new Date(e),t=Math.floor((s-a)/6e4);return t<60?`Hace ${t} min`:t<1440?`Hace ${Math.floor(t/60)} h`:`Hace ${Math.floor(t/1440)} d√≠as`};return r?g.jsx("div",{className:"flex justify-center items-center h-64",children:g.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"text-center mb-6",children:[g.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center justify-center gap-2",children:[g.jsx(U,{className:"text-yellow-500"}),"Control de Pines"]}),g.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona y monitorea el uso de pines por psic√≥logo"})]}),x.length>0&&g.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[g.jsxs("div",{className:"flex items-center mb-2",children:[g.jsx(T,{className:"text-yellow-600 mr-2"}),g.jsx("h3",{className:"text-lg font-semibold text-yellow-800",children:"Alertas de Pines"})]}),g.jsx("div",{className:"space-y-2",children:x.map((e,s)=>g.jsx("div",{className:"text-yellow-700",children:e.message},e.psychologist_id))})]}),g.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0 mb-6",children:[g.jsxs("div",{className:"flex items-center space-x-4",children:[g.jsx(D,{className:"text-gray-400"}),g.jsx("select",{value:t,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"24hours",label:"√öltimas 24 horas"},{value:"7days",label:"√öltimos 7 d√≠as"},{value:"30days",label:"√öltimos 30 d√≠as"},{value:"90days",label:"√öltimos 90 d√≠as"}].map(e=>g.jsx("option",{value:e.value,children:e.label},e.value))})]}),g.jsxs("div",{className:"flex space-x-3",children:[g.jsxs("button",{onClick:()=>_(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[g.jsx(A,{}),g.jsx("span",{children:"Asignar Pines"})]}),g.jsxs("button",{onClick:()=>{try{const s=[["Psic√≥logo","Email","Total Pines","Pines Usados","Pines Restantes","Estado","Plan","Pacientes Asignados","Tests Completados"],...e.map(e=>[e.psychologist_name||"N/A",e.psychologist_email||"N/A",e.is_unlimited?"Ilimitado":e.total_pins||0,e.used_pins||0,e.is_unlimited?"Ilimitado":e.remaining_pins||0,le(e.status),e.plan_type||"N/A",e.assigned_patients||0,e.completed_tests||0])].map(e=>e.join(",")).join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download=`reporte_pines_${t}_${(new Date).toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(i),C.success("Reporte de pines exportado exitosamente")}catch(s){C.error("Error al exportar reporte")}},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[g.jsx(I,{}),g.jsx("span",{children:"Exportar Reporte"})]})]})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[g.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total Psic√≥logos"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ee.totalPsychologists})]}),g.jsx(m,{className:"w-8 h-8 text-blue-500"})]}),g.jsxs("div",{className:"mt-2 text-gray-500 text-xs",children:[e.filter(e=>e.total_asignado>0).length," con pines asignados"]})]}),g.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Pines Asignados"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ee.totalPinsAssigned})]}),g.jsx(U,{className:"w-8 h-8 text-green-500"})]}),g.jsx("div",{className:"mt-2 text-gray-500 text-xs",children:"0 planes ilimitados"})]}),g.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Pines Usados"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ee.totalPinsUsed})]}),g.jsx(z,{className:"w-8 h-8 text-orange-500"})]}),g.jsxs("div",{className:"mt-2 text-gray-500 text-xs",children:[e.reduce((e,s)=>e+(s.tests_completados||0),0)," tests completados"]})]}),g.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Pines Restantes"}),g.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ee.totalPinsRemaining})]}),g.jsx(O,{className:"w-8 h-8 text-purple-500"})]}),g.jsxs("div",{className:"mt-2 text-gray-500 text-xs",children:[e.reduce((e,s)=>e+(s.pacientes_asignados||0),0)," pacientes asignados"]})]})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between items-center mb-4",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Estado de Pines por Psic√≥logo"}),R.length>0&&g.jsxs("div",{className:"flex space-x-2",children:[g.jsxs("button",{onClick:()=>{X("pins"),q(!0)},className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",disabled:r,children:[g.jsx(y,{}),g.jsxs("span",{children:["Eliminar Pines (",R.length,")"]})]}),g.jsxs("button",{onClick:()=>{X("complete"),q(!0)},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",disabled:r,children:[g.jsx(N,{}),g.jsxs("span",{children:["Eliminar Asignaciones (",R.length,")"]})]}),g.jsxs("button",{onClick:()=>Q(!0),className:"bg-red-800 hover:bg-red-900 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",disabled:r,children:[g.jsx(f,{}),g.jsxs("span",{children:["Eliminar Asignaciones (",R.length,")"]})]})]})]}),g.jsx("div",{className:"overflow-x-auto",children:g.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[g.jsx("thead",{className:"bg-gray-50",children:g.jsxs("tr",{children:[g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g.jsx("input",{type:"checkbox",checked:B,onChange:()=>{G(B?[]:e.map(e=>e.psicologo_id)),F(!B)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Psic√≥logo"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pines Totales"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pines Usados"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pines Restantes"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pacientes"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tests"})]})}),g.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((e,s)=>g.jsxs("tr",{className:"hover:bg-gray-50 "+(R.includes(e.psicologo_id)?"bg-blue-50":""),children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("input",{type:"checkbox",checked:R.includes(e.psicologo_id),onChange:()=>{return s=e.psicologo_id,void G(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.nombre_psicologo||"N/A"})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm text-gray-500",children:e.email_psicologo||"N/A"})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm text-gray-900 flex items-center",children:e.total_asignado||0})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm text-gray-900",children:e.total_consumido||0})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm text-gray-900",children:e.pines_restantes||0})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re(e.status)}`,children:le(e.status)})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.pacientes_asignados||0}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.tests_completados||0})]},e.psicologo_id||s))})]})})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between items-center mb-4",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Historial de Actividad de Pines"}),S.length>0&&g.jsxs("button",{onClick:()=>c(null,null,function*(){if(0===S.length)return void C.error("No hay registros seleccionados");if(!window.confirm(`¬øSeguro que deseas eliminar ${S.length} registros seleccionados?`))return;const e=C.loading(`Eliminando ${S.length} transacciones...`);try{const s=yield V.deleteMultipleTransactions(S);s.success?(C.update(e,{render:`${s.deletedCount} transacciones eliminadas exitosamente`,type:"success",isLoading:!1,autoClose:3e3}),E([]),$(!1),yield se(),s.affectedPsychologists):C.update(e,{render:`Error al eliminar transacciones: ${s.message}`,type:"error",isLoading:!1,autoClose:5e3})}catch(s){C.update(e,{render:"Error inesperado al eliminar transacciones",type:"error",isLoading:!1,autoClose:5e3})}}),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",disabled:r,children:[g.jsx(N,{}),g.jsxs("span",{children:["Eliminar Seleccionados (",S.length,")"]})]})]}),g.jsx("div",{className:"overflow-x-auto",children:g.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[g.jsx("thead",{className:"bg-gray-50",children:g.jsxs("tr",{children:[g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g.jsx("input",{type:"checkbox",checked:L,onChange:()=>{E(L?[]:n.map(e=>e.id)),$(!L)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Psic√≥logo"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acci√≥n"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paciente"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripci√≥n"}),g.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),g.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((e,s)=>{var a;return g.jsxs("tr",{className:"hover:bg-gray-50 "+(S.includes(e.id)?"bg-blue-50":""),children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("input",{type:"checkbox",checked:S.includes(e.id),onChange:()=>{return s=e.id,void E(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),g.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[g.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.psicologos?`${e.psicologos.nombre} ${e.psicologos.apellido}`:"N/A"}),g.jsx("div",{className:"text-sm text-gray-500",children:(null==(a=e.psicologos)?void 0:a.email)||"N/A"})]}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsxs("div",{className:"flex items-center space-x-2",children:[ae(e.tipo),g.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${ie(e.tipo)}`,children:"asignacion"===e.tipo?"Asignaci√≥n":"Consumo"})]})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("div",{className:"text-sm text-gray-900",children:"-"})}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ne(e.created_at)}),g.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.motivo||"Sin descripci√≥n"}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.jsx("button",{onClick:()=>{return s=e.id,c(null,null,function*(){if(!window.confirm("¬øEst√°s seguro de que deseas eliminar esta transacci√≥n? Esta acci√≥n no se puede deshacer."))return;const e=C.loading("Eliminando transacci√≥n...");try{const a=yield V.deleteTransaction(s);a.success?(C.update(e,{render:"Transacci√≥n eliminada exitosamente",type:"success",isLoading:!1,autoClose:3e3}),yield se()):C.update(e,{render:`Error al eliminar transacci√≥n: ${a.message}`,type:"error",isLoading:!1,autoClose:5e3})}catch(a){C.update(e,{render:"Error inesperado al eliminar transacci√≥n",type:"error",isLoading:!1,autoClose:5e3})}});var s},className:"p-2 text-red-600 hover:bg-red-100 rounded-full transition-colors",title:"Eliminar Transacci√≥n",disabled:r,children:g.jsx(N,{className:"w-4 h-4"})})})]},e.id||s)})})]})})]})]}),P&&g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Asignar Pines"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Psic√≥logo"}),g.jsxs("select",{value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[g.jsx("option",{value:"",children:"Seleccionar psic√≥logo..."}),e.map((e,s)=>g.jsxs("option",{value:e.psicologo_id,children:[e.nombre_psicologo," (",e.email_psicologo,")",e.total_asignado>0?` - ${e.pines_restantes||0} pines`:" - Sin pines asignados"]},e.psicologo_id||s))]})]}),g.jsx("div",{children:g.jsxs("label",{className:"flex items-center space-x-2",children:[g.jsx("input",{type:"checkbox",checked:w,onChange:e=>k(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),g.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Plan Ilimitado"})]})}),!w&&g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cantidad de Pines"}),g.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,5,10,25,50,100].map(e=>g.jsx("button",{onClick:()=>v(e),className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(j===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))}),g.jsx("input",{type:"number",value:j,onChange:e=>v(parseInt(e.target.value)||1),min:"1",className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cantidad personalizada"})]})]}),g.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[g.jsx("button",{onClick:()=>{_(!1),b(""),v(1),k(!1)},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancelar"}),g.jsx("button",{onClick:()=>c(null,null,function*(){if(h)try{l(!0),yield V.assignPins(h,w?0:j,w,w?"unlimited":"manual"),C.success(`Pines ${w?"ilimitados":j} asignados correctamente`),_(!1),b(""),v(1),k(!1),yield se()}catch(e){C.error("Error al asignar pines")}finally{l(!1)}else C.error("Selecciona un psic√≥logo")}),disabled:!h||r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"Asignando...":"Asignar Pines"})]})]})}),H&&g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[g.jsxs("div",{className:"flex items-center mb-4",children:[g.jsx(T,{className:"text-yellow-500 text-xl mr-3"}),g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"pins"===J?"Eliminar Pines":"Eliminar Asignaciones Completas"})]}),g.jsxs("div",{className:"mb-4",children:[g.jsx("p",{className:"text-gray-600 mb-3",children:"pins"===J?`¬øEst√°s seguro de que deseas eliminar pines de ${R.length} psic√≥logo(s) seleccionado(s)?`:`¬øEst√°s seguro de que deseas eliminar TODAS las asignaciones de pines de ${R.length} psic√≥logo(s) seleccionado(s)? Esta acci√≥n no se puede deshacer.`}),"pins"===J&&g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cantidad de pines a eliminar:"}),g.jsx("input",{type:"number",value:W,onChange:e=>Y(parseInt(e.target.value)||1),min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cantidad de pines"})]})]}),g.jsxs("div",{className:"flex justify-end space-x-3",children:[g.jsx("button",{onClick:()=>{q(!1),Y(1)},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancelar"}),g.jsx("button",{onClick:()=>c(null,null,function*(){if(0===R.length)return void C.error("Selecciona al menos un psic√≥logo");if("pins"===J&&(!W||W<=0))return void C.error("Ingresa una cantidad v√°lida de pines a eliminar");const e="complete"===J?`¬øEst√°s seguro de eliminar COMPLETAMENTE todas las asignaciones de pines de ${R.length} psic√≥logo(s)? Esta acci√≥n no se puede deshacer.`:`¬øEst√°s seguro de eliminar ${W} pines de ${R.length} psic√≥logo(s)?`;if(!window.confirm(e))return;const s=C.loading("complete"===J?"Eliminando asignaciones completas...":`Eliminando ${W} pines...`);try{let e;if("complete"===J)e=1===R.length?yield V.removePsychologistPinAssignment(R[0],"Eliminaci√≥n completa desde panel de control"):yield V.removeMultiplePsychologistAssignments(R,"Eliminaci√≥n masiva desde panel de control");else{const s=R.map(e=>V.removePinsFromPsychologist(e,W,`Eliminaci√≥n de ${W} pines desde panel de control`)),a=(yield Promise.all(s)).filter(e=>e.success).length;e={success:a>0,deletedCount:a,totalRequested:R.length}}if(e.success){const a="complete"===J?`Asignaciones eliminadas exitosamente para ${e.deletedCount||R.length} psic√≥logo(s)`:`${W} pines eliminados exitosamente de ${e.deletedCount||R.length} psic√≥logo(s)`;C.update(s,{render:a,type:"success",isLoading:!1,autoClose:3e3}),G([]),F(!1),q(!1),Y(1),yield se()}else C.update(s,{render:`Error: ${e.message||"No se pudieron procesar las eliminaciones"}`,type:"error",isLoading:!1,autoClose:5e3})}catch(a){C.update(s,{render:"Error inesperado al procesar la eliminaci√≥n",type:"error",isLoading:!1,autoClose:5e3})}}),disabled:r||"pins"===J&&W<1,className:`px-4 py-2 text-white rounded-lg transition-colors ${"pins"===J?"bg-orange-600 hover:bg-orange-700":"bg-red-600 hover:bg-red-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:r?"Procesando...":"pins"===J?"Eliminar Pines":"Eliminar Asignaciones"})]})]})}),Z&&g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[g.jsxs("div",{className:"flex items-center mb-4",children:[g.jsx(f,{className:"text-red-500 text-xl mr-3"}),g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Eliminar Asignaciones de Pines"})]}),g.jsxs("div",{className:"mb-4",children:[g.jsxs("p",{className:"text-gray-600 mb-3",children:["¬øEst√°s seguro de que deseas eliminar las asignaciones de pines de ",R.length," psic√≥logo(s)?"]}),g.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[g.jsx("p",{className:"text-red-800 text-sm font-medium mb-2",children:"‚ö†Ô∏è ADVERTENCIA: Esta acci√≥n eliminar√°:"}),g.jsxs("ul",{className:"text-red-700 text-sm list-disc list-inside space-y-1",children:[g.jsx("li",{children:"Todas las asignaciones de pines"}),g.jsx("li",{children:"Todo el historial de transacciones de pines"}),g.jsx("li",{children:"Los pines restantes del psic√≥logo"})]}),g.jsx("p",{className:"text-red-800 text-sm font-bold mt-2",children:"Los datos del psic√≥logo se mantendr√°n. Esta acci√≥n NO se puede deshacer."})]})]}),g.jsxs("div",{className:"flex justify-end space-x-3",children:[g.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancelar"}),g.jsx("button",{onClick:()=>c(null,null,function*(){if(0===R.length)return void C.error("Selecciona al menos un psic√≥logo");const e=`¬øEst√°s seguro de eliminar las asignaciones de pines de ${R.length} psic√≥logo(s)? Esta acci√≥n eliminar√° todas sus transacciones de pines pero mantendr√° sus datos de usuario. Esta acci√≥n no se puede deshacer.`;if(!window.confirm(e))return;const s=C.loading(`Eliminando asignaciones de pines de ${R.length} psic√≥logo(s)...`);try{let e;if(e=1===R.length?yield a.removePsychologistPinAssignment(R[0],"Eliminaci√≥n desde panel de control"):yield a.removeMultiplePsychologistAssignments(R,"Eliminaci√≥n m√∫ltiple desde panel de control"),e.success){const a=1===R.length?`Asignaciones de pines eliminadas exitosamente para ${e.psychologist_name||"el psic√≥logo"}`:`Asignaciones eliminadas: ${e.successCount} exitosos${e.errorCount>0?`, ${e.errorCount} con errores`:""}`;C.update(s,{render:a,type:e.errorCount>0?"warning":"success",isLoading:!1,autoClose:5e3}),e.errors&&e.errors.length>0&&e.errors.forEach(e=>{C.error(`Error al eliminar asignaciones del psic√≥logo ${e.psychologist_id}: ${e.error}`,{autoClose:8e3})})}else C.update(s,{render:`Error: ${e.message}`,type:"error",isLoading:!1,autoClose:5e3});G([]),F(!1),Q(!1),yield se()}catch(t){C.update(s,{render:"Error inesperado al eliminar asignaciones de pines",type:"error",isLoading:!1,autoClose:5e3})}}),disabled:r,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Eliminando...":"Eliminar Asignaciones"})]})]})}),g.jsx(te,{isOpen:P,onClose:()=>_(!1),onSuccess:se})]})},re=()=>{const[e,s]=d.useState("profile"),[a,t]=d.useState({nombre:"Usuario Demo",apellido:"Sistema",email:"usuario@bat7.com",documento:"12345678"}),[i,r]=d.useState({emailNotifications:!0,pushNotifications:!1,weeklyReports:!0}),[l,c]=d.useState({twoFactorAuth:!1,sessionTimeout:"30",passwordExpiry:"90"}),m=[{id:"profile",name:"Perfil",icon:P,description:"Informaci√≥n personal"},{id:"notifications",name:"Notificaciones",icon:R,description:"Preferencias de notificaciones"},{id:"security",name:"Seguridad",icon:G,description:"Configuraci√≥n de seguridad"}],x=(e,s)=>{t(a=>o(n({},a),{[e]:s}))},u=(e,s)=>{r(a=>o(n({},a),{[e]:s}))},p=(e,s)=>{c(a=>o(n({},a),{[e]:s}))},h=()=>g.jsxs("div",{className:"space-y-6",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Informaci√≥n Personal"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre"}),g.jsxs("div",{className:"relative",children:[g.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),g.jsx("input",{type:"text",value:a.nombre,onChange:e=>x("nombre",e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apellido"}),g.jsxs("div",{className:"relative",children:[g.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),g.jsx("input",{type:"text",value:a.apellido,onChange:e=>x("apellido",e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),g.jsxs("div",{className:"relative",children:[g.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),g.jsx("input",{type:"email",value:a.email,onChange:e=>x("email",e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento"}),g.jsx("input",{type:"text",value:a.documento,onChange:e=>x("documento",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]});return g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"text-center mb-6",children:[g.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuraci√≥n Personal"}),g.jsx("p",{className:"text-gray-600 mt-2",children:"Administra tu perfil y preferencias"})]}),g.jsx("div",{className:"flex flex-wrap gap-4 mb-8 justify-center",children:m.map(a=>g.jsxs("button",{onClick:()=>s(a.id),className:"flex items-center px-6 py-3 rounded-lg font-medium transition-colors "+(e===a.id?"bg-blue-600 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"),children:[g.jsx(a.icon,{className:"w-5 h-5 mr-2"}),a.name]},a.id))}),g.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(()=>{switch(e){case"profile":default:return h();case"notifications":return g.jsxs("div",{className:"space-y-6",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Preferencias de Notificaciones"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Notificaciones por Email"}),g.jsx("p",{className:"text-sm text-gray-500",children:"Recibir notificaciones importantes por correo"})]}),g.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[g.jsx("input",{type:"checkbox",checked:i.emailNotifications,onChange:e=>u("emailNotifications",e.target.checked),className:"sr-only peer"}),g.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Notificaciones Push"}),g.jsx("p",{className:"text-sm text-gray-500",children:"Notificaciones en tiempo real en el navegador"})]}),g.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[g.jsx("input",{type:"checkbox",checked:i.pushNotifications,onChange:e=>u("pushNotifications",e.target.checked),className:"sr-only peer"}),g.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Reportes Semanales"}),g.jsx("p",{className:"text-sm text-gray-500",children:"Resumen semanal de actividad"})]}),g.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[g.jsx("input",{type:"checkbox",checked:i.weeklyReports,onChange:e=>u("weeklyReports",e.target.checked),className:"sr-only peer"}),g.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]});case"security":return g.jsxs("div",{className:"space-y-6",children:[g.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configuraci√≥n de Seguridad"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Autenticaci√≥n de Dos Factores"}),g.jsx("p",{className:"text-sm text-gray-500",children:"Agregar una capa extra de seguridad"})]}),g.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[g.jsx("input",{type:"checkbox",checked:l.twoFactorAuth,onChange:e=>p("twoFactorAuth",e.target.checked),className:"sr-only peer"}),g.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tiempo de Sesi√≥n (minutos)"}),g.jsxs("select",{value:l.sessionTimeout,onChange:e=>p("sessionTimeout",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[g.jsx("option",{value:"15",children:"15 minutos"}),g.jsx("option",{value:"30",children:"30 minutos"}),g.jsx("option",{value:"60",children:"1 hora"}),g.jsx("option",{value:"120",children:"2 horas"})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiraci√≥n de Contrase√±a (d√≠as)"}),g.jsxs("select",{value:l.passwordExpiry,onChange:e=>p("passwordExpiry",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[g.jsx("option",{value:"30",children:"30 d√≠as"}),g.jsx("option",{value:"60",children:"60 d√≠as"}),g.jsx("option",{value:"90",children:"90 d√≠as"}),g.jsx("option",{value:"180",children:"180 d√≠as"})]})]})]})]})}})(),g.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:g.jsxs("button",{onClick:()=>{alert("Configuraci√≥n guardada correctamente")},className:"w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center space-x-2 transition-colors",children:[g.jsx(B,{className:"w-5 h-5"}),g.jsx("span",{children:"Guardar Cambios"})]})})]})]})},le=()=>{var e;const{user:s,userRole:a}=q(),[t,i]=d.useState("dashboard"),r="administrador"===a||"administrador"===(null==s?void 0:s.tipo_usuario),l=[{id:"dashboard",name:"Dashboard",icon:x,component:Z,adminOnly:!0,description:"Resumen general del sistema"},{id:"users",name:"Gesti√≥n de Usuarios",icon:m,component:Q,adminOnly:!0,description:"Administra usuarios del sistema"},{id:"access",name:"Control de Acceso",icon:G,component:se,adminOnly:!0,description:"Gestiona permisos de acceso a p√°ginas"},{id:"assignments",name:"Asignaci√≥n de Pacientes",icon:k,component:ae,adminOnly:!0,description:"Asigna pacientes a psic√≥logos"},{id:"usage",name:"Control de Pines",icon:z,component:ie,adminOnly:!0,description:"Gestiona y monitorea el uso de pines por psic√≥logo"},{id:"settings",name:"Configuraci√≥n Personal",icon:H,component:re,adminOnly:!1,description:"Configuraci√≥n personal y preferencias"}],n=d.useMemo(()=>l.filter(e=>!e.adminOnly||r),[r]);d.useEffect(()=>{n.length>0&&!n.some(e=>e.id===t)&&i(n[0].id)},[n,t]);return r||0!==n.length?g.jsxs("div",{className:"min-h-screen bg-gray-50",children:[g.jsx(J,{title:"Configuraci√≥n del Sistema",subtitle:"Gestiona usuarios, configuraciones y estad√≠sticas del sistema",icon:H}),g.jsxs("div",{className:"container mx-auto px-4 py-8",children:[g.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6",children:[g.jsx("div",{className:"border-b border-gray-200",children:g.jsx("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:n.map(e=>{const s=e.icon,a=t===e.id;return g.jsxs("button",{onClick:()=>i(e.id),className:`\n                      flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200\n                      ${a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}\n                    `,"aria-current":a?"page":void 0,children:[g.jsx(s,{className:"w-5 h-5 "+(a?"text-blue-600":"text-gray-400")}),g.jsx("span",{children:e.name})]},e.id)})})}),g.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:g.jsx("p",{className:"text-sm text-gray-600",children:null==(e=n.find(e=>e.id===t))?void 0:e.description})}),g.jsx("div",{className:"p-6",children:(()=>{const e=n.find(e=>e.id===t);if(!e)return null;const s=e.component;return g.jsx(s,{})})()})]}),g.jsx("div",{className:"text-center text-sm text-gray-500",children:g.jsxs("p",{children:["Sistema de Administraci√≥n BAT-7 ‚Ä¢ Usuario: ",null==s?void 0:s.nombre," ",null==s?void 0:s.apellido," ‚Ä¢ Rol: ",a||(null==s?void 0:s.tipo_usuario)]})})]})]}):g.jsx("div",{className:"container mx-auto px-4 py-8",children:g.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:g.jsxs("div",{className:"text-yellow-800",children:[g.jsx("h3",{className:"text-lg font-medium",children:"Acceso Restringido"}),g.jsx("p",{className:"mt-2",children:"No tienes permisos para acceder a esta secci√≥n."})]})})})};export{le as default};

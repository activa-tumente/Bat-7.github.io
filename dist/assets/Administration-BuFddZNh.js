var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,l=(e,s)=>{for(var t in s||(s={}))i.call(s,t)&&n(e,t,s[t]);if(a)for(var t of a(s))r.call(s,t)&&n(e,t,s[t]);return e},o=(e,a)=>s(e,t(a)),c=(e,s,t)=>new Promise((a,i)=>{var r=e=>{try{l(t.next(e))}catch(s){i(s)}},n=e=>{try{l(t.throw(e))}catch(s){i(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,n);l((t=t.apply(e,s)).next())});import{r as d,j as m,F as u,Q as x,H as p,N as h,I as g,J as b,R as f,O as j,a0 as y,a as v,M as N,m as w,a2 as C}from"./vendor-DFW_gwso.js";import{P as _}from"./PageHeader-Yn2bRdE6.js";import{s as S,S as k,C as P,b as E,a as D,B as I}from"./index-C3qB8JJ6.js";const A=(e,s,t,a)=>c(null,null,function*(){try{yield S.from("logs").insert({action:e,table_name:s,record_id:t,data:a,created_at:(new Date).toISOString()})}catch(i){}}),q={checkConnection(){return c(this,null,function*(){try{const{data:e,error:s}=yield S.rpc("get_tables");if(s)throw s;return{success:!0,data:e}}catch(e){return{success:!1,error:e}}})},getInstitutions(){return c(this,null,function*(){return yield S.from("instituciones").select("*").order("nombre",{ascending:!0})})},createInstitution(e){return c(this,null,function*(){const s={nombre:e.nombre,direccion:e.direccion||"",telefono:e.telefono||"",email:e.email||"",sitio_web:e.sitio_web||"",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},t=yield S.from("instituciones").insert([s]).select();return t.data&&t.data.length>0&&(yield A("create","instituciones",t.data[0].id,s)),t})},updateInstitution(e,s){return c(this,null,function*(){const t={nombre:s.nombre,direccion:s.direccion||"",telefono:s.telefono||"",email:s.email||"",sitio_web:s.sitio_web||"",updated_at:(new Date).toISOString()},a=yield S.from("instituciones").update(t).eq("id",e).select();return a.data&&a.data.length>0&&(yield A("update","instituciones",e,t)),a})},deleteInstitution(e){return c(this,null,function*(){const{data:s}=yield S.from("instituciones").select("*").eq("id",e).single(),t=yield S.from("instituciones").delete().eq("id",e);return!t.error&&s&&(yield A("delete","instituciones",e,s)),t})},getPsychologists(){return c(this,null,function*(){return yield S.from("psicologos").select("*, instituciones(id, nombre)").order("nombre",{ascending:!0})})},createPsychologist(e){return c(this,null,function*(){const s={usuario_id:e.usuario_id||null,institucion_id:e.institucion_id,nombre:e.nombre,apellido:e.apellido||"",email:e.email||"",telefono:e.telefono||"",genero:e.genero||"",especialidad:e.especialidad||"",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},t=yield S.from("psicologos").insert([s]).select();return t.data&&t.data.length>0&&(yield A("create","psicologos",t.data[0].id,s)),t})},updatePsychologist(e,s){return c(this,null,function*(){const t={institucion_id:s.institucion_id,nombre:s.nombre,apellido:s.apellido||"",email:s.email||"",telefono:s.telefono||"",genero:s.genero||"",especialidad:s.especialidad||"",updated_at:(new Date).toISOString()},a=yield S.from("psicologos").update(t).eq("id",e).select();return a.data&&a.data.length>0&&(yield A("update","psicologos",e,t)),a})},deletePsychologist(e){return c(this,null,function*(){const{data:s}=yield S.from("psicologos").select("*").eq("id",e).single(),t=yield S.from("psicologos").delete().eq("id",e);return!t.error&&s&&(yield A("delete","psicologos",e,s)),t})},getPatients(){return c(this,null,function*(){return yield S.from("pacientes").select("*, instituciones(id, nombre), psicologos(id, nombre, apellido)").order("nombre",{ascending:!0})})},createPatient(e){return c(this,null,function*(){const s={psicologo_id:e.psicologo_id||null,institucion_id:e.institucion_id,nombre:e.nombre,apellido:e.apellido||e.apellidos||"",documento:e.documento||e.documento_identidad||"",email:e.email||"",genero:e.genero||"",fecha_nacimiento:e.fecha_nacimiento||null,nivel_educativo:e.nivel_educativo||"",ocupacion:e.ocupacion||"",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},t=yield S.from("pacientes").insert([s]).select();return t.data&&t.data.length>0&&(yield A("create","pacientes",t.data[0].id,s)),t})},updatePatient(e,s){return c(this,null,function*(){const t={psicologo_id:s.psicologo_id||null,institucion_id:s.institucion_id,nombre:s.nombre,apellido:s.apellido||s.apellidos||"",documento:s.documento||s.documento_identidad||"",email:s.email||"",genero:s.genero||"",fecha_nacimiento:s.fecha_nacimiento||null,nivel_educativo:s.nivel_educativo||"",ocupacion:s.ocupacion||"",updated_at:(new Date).toISOString()},a=yield S.from("pacientes").update(t).eq("id",e).select();return a.data&&a.data.length>0&&(yield A("update","pacientes",e,t)),a})},deletePatient(e){return c(this,null,function*(){const{data:s}=yield S.from("pacientes").select("*").eq("id",e).single(),t=yield S.from("pacientes").delete().eq("id",e);return!t.error&&s&&(yield A("delete","pacientes",e,s)),t})},getPatientsByPsychologist(e){return c(this,null,function*(){return yield S.from("pacientes").select("*").eq("psicologo_id",e).order("nombre",{ascending:!0})})},getPatientsByInstitution(e){return c(this,null,function*(){return yield S.from("pacientes").select("*").eq("institucion_id",e).order("nombre",{ascending:!0})})},getPsychologistsByInstitution(e){return c(this,null,function*(){return yield S.from("psicologos").select("*").eq("institucion_id",e).order("nombre",{ascending:!0})})}},O=({initialData:e,onSubmit:s,onCancel:t})=>{const[a,i]=d.useState({nombre:"",direccion:"",telefono:"",email:"",sitio_web:""}),[r,n]=d.useState(!1);d.useEffect(()=>{e&&i({nombre:e.nombre||"",direccion:e.direccion||"",telefono:e.telefono||"",email:e.email||"",sitio_web:e.sitio_web||""})},[e]);const x=e=>{const{name:s,value:t,type:r,checked:n}=e.target;i(o(l({},a),{[s]:"checkbox"===r?n:t}))};return m.jsxs("form",{onSubmit:e=>c(null,null,function*(){if(e.preventDefault(),a.nombre.trim()||(alert("El nombre de la institución es obligatorio"),0)){n(!0);try{yield s(a)}catch(t){}finally{n(!1)}}}),className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Institución *"}),m.jsx("input",{type:"text",name:"nombre",value:a.nombre,onChange:x,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),m.jsx("input",{type:"email",name:"email",value:a.email,onChange:x,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección"}),m.jsx("input",{type:"text",name:"direccion",value:a.direccion,onChange:x,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),m.jsx("input",{type:"text",name:"telefono",value:a.telefono,onChange:x,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sitio Web"}),m.jsx("input",{type:"url",name:"sitio_web",value:a.sitio_web,onChange:x,className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"https://ejemplo.com"})]})]}),m.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[m.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),m.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:r,children:r?m.jsxs(m.Fragment,{children:[m.jsx(u,{className:"animate-spin inline mr-2"}),"Guardando..."]}):e?"Actualizar":"Crear"})]})]})},L=()=>{const[e,s]=d.useState([]),[t,a]=d.useState(!0),[i,r]=d.useState(!1),[n,l]=d.useState(null),[o,f]=d.useState("");d.useEffect(()=>{j()},[]);const j=()=>c(null,null,function*(){a(!0);try{const{data:e,error:t}=yield q.getInstitutions();if(t)throw t;s(e||[])}catch(e){x.error("Error al cargar las instituciones")}finally{a(!1)}}),y=(e=null)=>{l(e),r(!0)},v=()=>{r(!1),l(null)},N=e.filter(e=>{var s,t,a,i;return(null==(s=e.nombre)?void 0:s.toLowerCase().includes(o.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(o.toLowerCase()))||(null==(a=e.direccion)?void 0:a.toLowerCase().includes(o.toLowerCase()))||(null==(i=e.telefono)?void 0:i.toLowerCase().includes(o.toLowerCase()))});return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestión de Instituciones"}),m.jsx("p",{className:"text-gray-600",children:"Administre las instituciones registradas en el sistema"})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",placeholder:"Buscar institución...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:o,onChange:e=>f(e.target.value)}),m.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:m.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]}),m.jsxs("button",{onClick:()=>y(),className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:t,children:[m.jsx(p,{className:"mr-2"}),"Nueva Institución"]})]})]}),m.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:t?m.jsxs("div",{className:"flex justify-center items-center p-8",children:[m.jsx(u,{className:"animate-spin text-blue-600 text-2xl mr-2"}),m.jsx("span",{children:"Cargando instituciones..."})]}):0===N.length?m.jsx("div",{className:"text-center p-8 text-gray-500",children:o?"No se encontraron instituciones que coincidan con la búsqueda.":"No hay instituciones registradas."}):m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[m.jsx("thead",{className:"bg-sky-800",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Nombre"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Email"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Dirección"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Teléfono"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Sitio Web"}),m.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider",children:"Acciones"})]})}),m.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>m.jsxs("tr",{className:"hover:bg-gray-50",children:[m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(h,{className:"text-gray-500 mr-2"}),m.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.nombre})]})}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.direccion}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.telefono}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.sitio_web?m.jsx("a",{href:e.sitio_web,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:e.sitio_web.replace(/^https?:\/\//,"").split("/")[0]}):"-"}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[m.jsx("button",{onClick:()=>y(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:m.jsx(g,{})}),m.jsx("button",{onClick:()=>{return s=e.id,c(null,null,function*(){if(window.confirm("¿Está seguro de que desea eliminar esta institución?"))try{a(!0);const{error:e}=yield q.deleteInstitution(s);if(e)throw e;x.success("Institución eliminada correctamente"),j()}catch(e){x.error("Error al eliminar la institución")}finally{a(!1)}});var s},className:"text-red-600 hover:text-red-900",children:m.jsx(b,{})})]})]},e.id))})]})})}),i&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4",children:[m.jsx("h2",{className:"text-xl font-bold mb-4",children:n?"Editar Institución":"Nueva Institución"}),m.jsx(O,{initialData:n,onSubmit:e=>c(null,null,function*(){try{let s;if(a(!0),n){if(s=yield q.updateInstitution(n.id,e),s.error)throw s.error;x.success("Institución actualizada correctamente")}else{if(s=yield q.createInstitution(e),s.error)throw s.error;x.success("Institución creada correctamente")}j(),v()}catch(s){x.error(n?"Error al actualizar la institución":"Error al crear la institución")}finally{a(!1)}}),onCancel:v})]})})]})},z=()=>{const[e,s]=d.useState([]),[t,a]=d.useState([]),[i,r]=d.useState(!0),[n,h]=d.useState(!1),[y,v]=d.useState(null),[N,w]=d.useState(""),[C,_]=d.useState({nombre:"",apellido:"",genero:"masculino",email:"",telefono:"",especialidad:"",institucion_id:""});d.useEffect(()=>{S(),k()},[]);const S=()=>c(null,null,function*(){r(!0);try{const{data:e,error:t}=yield q.getPsychologists();if(t)throw t;s(e||[])}catch(e){x.error("Error al cargar los psicólogos")}finally{r(!1)}}),k=()=>c(null,null,function*(){try{const{data:e,error:s}=yield q.getInstitutions();if(s)throw s;a(e||[])}catch(e){x.error("Error al cargar las instituciones")}}),P=(e=null)=>{v(e),_(e?{nombre:e.nombre||"",apellido:e.apellido||"",genero:e.genero||"masculino",email:e.email||"",telefono:e.telefono||"",especialidad:e.especialidad||"",institucion_id:e.institucion_id||"",activo:!1!==e.activo}:{nombre:"",apellido:"",genero:"masculino",email:"",telefono:"",especialidad:"",institucion_id:"",activo:!0}),h(!0)},E=()=>{h(!1),v(null)},D=e=>{const{name:s,value:t,type:a,checked:i}=e.target;_(o(l({},C),{[s]:"checkbox"===a?i:t}))},I=e.filter(e=>{var s,t,a,i;return(null==(s=e.nombre)?void 0:s.toLowerCase().includes(N.toLowerCase()))||(null==(t=e.apellido)?void 0:t.toLowerCase().includes(N.toLowerCase()))||(null==(a=e.email)?void 0:a.toLowerCase().includes(N.toLowerCase()))||(null==(i=e.especialidad)?void 0:i.toLowerCase().includes(N.toLowerCase()))}),A=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"No asignada"};return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestión de Psicólogos"}),m.jsx("p",{className:"text-gray-600",children:"Administre los psicólogos registrados en el sistema"})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",placeholder:"Buscar psicólogo...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:N,onChange:e=>w(e.target.value)}),m.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:m.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]}),m.jsxs("button",{onClick:()=>P(),className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:i,children:[m.jsx(p,{className:"mr-2"}),"Nuevo Psicólogo"]})]})]}),m.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:i&&0===e.length?m.jsxs("div",{className:"flex justify-center items-center p-8",children:[m.jsx(u,{className:"animate-spin text-blue-600 text-2xl mr-2"}),m.jsx("span",{children:"Cargando psicólogos..."})]}):0===I.length?m.jsx("div",{className:"text-center p-8 text-gray-500",children:N?"No se encontraron psicólogos que coincidan con la búsqueda.":"No hay psicólogos registrados."}):m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[m.jsx("thead",{className:"bg-sky-800",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Nombre"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Email"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Teléfono"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Especialidad"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Institución"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Estado"}),m.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider",children:"Acciones"})]})}),m.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.map(e=>m.jsxs("tr",{className:"hover:bg-gray-50",children:[m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxs("div",{className:"flex items-center",children:["femenino"===e.genero?m.jsx(f,{className:"text-pink-500 mr-2"}):m.jsx(j,{className:"text-blue-500 mr-2"}),m.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.nombre," ",e.apellido]})]})}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email||"-"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.telefono||"-"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.especialidad||"-"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(e.institucion_id)}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(e.activo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.activo?"Activo":"Inactivo"})}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[m.jsx("button",{onClick:()=>P(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:m.jsx(g,{})}),m.jsx("button",{onClick:()=>{return s=e.id,c(null,null,function*(){if(window.confirm("¿Está seguro de que desea eliminar este psicólogo?"))try{r(!0);const{error:e}=yield q.deletePsychologist(s);if(e)throw e;x.success("Psicólogo eliminado correctamente"),S()}catch(e){x.error("Error al eliminar el psicólogo")}finally{r(!1)}});var s},className:"text-red-600 hover:text-red-900",children:m.jsx(b,{})})]})]},e.id))})]})})}),n&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4",children:[m.jsx("h2",{className:"text-xl font-bold mb-4",children:y?"Editar Psicólogo":"Nuevo Psicólogo"}),m.jsxs("form",{onSubmit:e=>c(null,null,function*(){if(e.preventDefault(),C.nombre.trim()?C.apellido.trim()?C.institucion_id?!C.email||/\S+@\S+\.\S+/.test(C.email)||(x.error("El email no es válido"),0):(x.error("Debe seleccionar una institución"),0):(x.error("El apellido es obligatorio"),0):(x.error("El nombre es obligatorio"),0))try{let e;if(r(!0),y){if(e=yield q.updatePsychologist(y.id,C),e.error)throw e.error;x.success("Psicólogo actualizado correctamente")}else{if(e=yield q.createPsychologist(C),e.error)throw e.error;x.success("Psicólogo creado correctamente")}S(),E()}catch(s){x.error(y?"Error al actualizar el psicólogo":"Error al crear el psicólogo")}finally{r(!1)}}),className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),m.jsx("input",{type:"text",name:"nombre",value:C.nombre,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido *"}),m.jsx("input",{type:"text",name:"apellido",value:C.apellido,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Género"}),m.jsxs("select",{name:"genero",value:C.genero,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md",children:[m.jsx("option",{value:"masculino",children:"Masculino"}),m.jsx("option",{value:"femenino",children:"Femenino"}),m.jsx("option",{value:"otro",children:"Otro"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),m.jsx("input",{type:"email",name:"email",value:C.email,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),m.jsx("input",{type:"text",name:"telefono",value:C.telefono,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Especialidad"}),m.jsx("input",{type:"text",name:"especialidad",value:C.especialidad,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Institución *"}),m.jsxs("select",{name:"institucion_id",value:C.institucion_id,onChange:D,className:"w-full p-2 border border-gray-300 rounded-md",required:!0,children:[m.jsx("option",{value:"",children:"Seleccione una institución"}),t.map(e=>m.jsx("option",{value:e.id,children:e.nombre},e.id))]})]})]}),m.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[m.jsx("button",{type:"button",onClick:E,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),m.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:i,children:i?m.jsxs(m.Fragment,{children:[m.jsx(u,{className:"animate-spin inline mr-2"}),"Guardando..."]}):y?"Actualizar":"Crear"})]})]})]})})]})},$=()=>{const[e,s]=d.useState([]),[t,a]=d.useState([]),[i,r]=d.useState([]),[n,h]=d.useState(!0),[y,v]=d.useState(!1),[N,w]=d.useState(null),[C,_]=d.useState(""),[S,k]=d.useState("nombre"),[P,E]=d.useState("asc"),[D,I]=d.useState({institucion_id:"",genero:"",psicologo_id:"",edad_min:"",edad_max:""}),[A,O]=d.useState({nombre:"",apellido:"",genero:"masculino",fecha_nacimiento:"",documento:"",email:"",nivel_educativo:"",ocupacion:"",institucion_id:"",psicologo_id:""});d.useEffect(()=>{L(),z(),$()},[]);const L=()=>c(null,null,function*(){h(!0);try{const{data:e,error:t}=yield q.getPatients();if(t)throw t;const a=(Array.isArray(e)?e:[]).map(e=>o(l({},e),{edad:V(e.fecha_nacimiento)}));s(a)}catch(e){x.error("Error: "+(e.message||"Error al cargar los pacientes"))}finally{h(!1)}}),z=()=>c(null,null,function*(){try{const{data:e,error:s}=yield q.getInstitutions();if(s)throw s;a(e||[])}catch(e){x.error("Error: "+(e.message||"Error al cargar las instituciones"))}}),$=()=>c(null,null,function*(){try{const{data:e,error:s}=yield q.getPsychologists();if(s)throw s;r(e||[])}catch(e){x.error("Error: "+(e.message||"Error al cargar los psicólogos"))}}),R=(e=null)=>{w(e),O(e?{nombre:e.nombre||"",apellido:e.apellido||"",genero:e.genero||"masculino",fecha_nacimiento:e.fecha_nacimiento||"",documento:e.documento||"",email:e.email||"",institucion_id:e.institucion_id||"",psicologo_id:e.psicologo_id||"",activo:!1!==e.activo}:{nombre:"",apellido:"",genero:"masculino",fecha_nacimiento:"",documento:"",email:"",institucion_id:"",psicologo_id:"",activo:!0}),v(!0)},B=()=>{v(!1),w(null)},F=e=>{const{name:s,value:t,type:a,checked:i}=e.target;O(o(l({},A),{[s]:"checkbox"===a?i:t}))},V=e=>{if(!e)return"-";const s=new Date,t=new Date(e);let a=s.getFullYear()-t.getFullYear();const i=s.getMonth()-t.getMonth();return(i<0||0===i&&s.getDate()<t.getDate())&&a--,a},M=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"No asignada"},G=e=>{const s=i.find(s=>s.id===e);return s?`${s.nombre} ${s.apellido}`:"No asignado"},T=e.filter(e=>{var s,a,i,r,n,l;const o=C.toLowerCase(),c=!C||(null==(s=e.nombre)?void 0:s.toLowerCase().includes(o))||(null==(a=e.apellidos)?void 0:a.toLowerCase().includes(o))||(null==(i=e.documento_identidad)?void 0:i.toLowerCase().includes(o))||(null==(r=e.email)?void 0:r.toLowerCase().includes(o))||((null==(n=t.find(s=>s.id===e.institucion_id))?void 0:n.nombre)||"").toLowerCase().includes(o)||(null==(l=e.notas)?void 0:l.toLowerCase().includes(o)),d=!D.institucion_id||e.institucion_id===D.institucion_id,m=!D.genero||e.genero===D.genero,u=!D.psicologo_id||("null"===D.psicologo_id?!e.psicologo_id:e.psicologo_id===D.psicologo_id),x="number"==typeof e.edad?e.edad:-1,p=parseInt(D.edad_min),h=isNaN(p)||-1===x||x>=p,g=parseInt(D.edad_max),b=isNaN(g)||-1===x||x<=g;return c&&d&&m&&u&&h&&b});return t.map(e=>({value:e.id,label:e.nombre})),i.map(e=>({value:e.id,label:`${e.nombre} ${e.apellidos}`})),t.map(e=>({value:e.id,label:e.nombre})),i.map(e=>({value:e.id,label:`${e.nombre} ${e.apellidos}`})),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestión de Pacientes"}),m.jsx("p",{className:"text-gray-600",children:"Administre los pacientes registrados en el sistema"})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",placeholder:"Buscar paciente...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:C,onChange:e=>_(e.target.value)}),m.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:m.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]}),m.jsxs("button",{onClick:()=>R(),className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:n,children:[m.jsx(p,{className:"mr-2"}),"Nuevo Paciente"]})]})]}),m.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:n&&0===e.length?m.jsxs("div",{className:"flex justify-center items-center p-8",children:[m.jsx(u,{className:"animate-spin text-blue-600 text-2xl mr-2"}),m.jsx("span",{children:"Cargando pacientes..."})]}):0===T.length?m.jsx("div",{className:"text-center p-8 text-gray-500",children:C?"No se encontraron pacientes que coincidan con la búsqueda.":"No hay pacientes registrados."}):m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[m.jsx("thead",{className:"bg-sky-800",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Nombre"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Documento"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Edad"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Contacto"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Institución"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Psicólogo"}),m.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider",children:"Acciones"})]})}),m.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(e=>m.jsxs("tr",{className:"hover:bg-gray-50",children:[m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxs("div",{className:"flex items-center",children:["femenino"===e.genero?m.jsx(f,{className:"text-pink-500 mr-2"}):m.jsx(j,{className:"text-blue-500 mr-2"}),m.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.nombre," ",e.apellido]})]})}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.documento||"-"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:V(e.fecha_nacimiento)}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email?m.jsx("div",{children:m.jsx("div",{children:e.email})}):e.email||"-"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:M(e.institucion_id)}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:G(e.psicologo_id)}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[m.jsx("button",{onClick:()=>R(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:m.jsx(g,{})}),m.jsx("button",{onClick:()=>{return s=e.id,c(null,null,function*(){if(window.confirm("¿Está seguro de que desea eliminar este paciente?"))try{h(!0);const{error:e}=yield q.deletePatient(s);if(e)throw e;x.success("Paciente eliminado correctamente"),L()}catch(e){x.error("Error: "+(e.message||"Error al eliminar el paciente"))}finally{h(!1)}});var s},className:"text-red-600 hover:text-red-900",children:m.jsx(b,{})})]})]},e.id))})]})})}),y&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4",children:[m.jsx("h2",{className:"text-xl font-bold mb-4",children:N?"Editar Paciente":"Nuevo Paciente"}),m.jsxs("form",{onSubmit:e=>c(null,null,function*(){if(e.preventDefault(),A.nombre.trim()?A.apellido.trim()?A.institucion_id?!A.email||/\S+@\S+\.\S+/.test(A.email)||(x.error("El email no es válido"),0):(x.error("Debe seleccionar una institución"),0):(x.error("El apellido es obligatorio"),0):(x.error("El nombre es obligatorio"),0))try{h(!0);const e={nombre:A.nombre,apellido:A.apellido,genero:A.genero,fecha_nacimiento:A.fecha_nacimiento||null,documento:A.documento||"",email:A.email||"",institucion_id:A.institucion_id,psicologo_id:A.psicologo_id||null,activo:A.activo,updated_at:(new Date).toISOString()};let s;if(N||(e.created_at=(new Date).toISOString()),N){if(s=yield q.updatePatient(N.id,e),s.error)throw s.error;x.success(`Paciente "${A.nombre}" actualizado correctamente`)}else{if(s=yield q.createPatient(e),s.error)throw s.error;x.success(`Paciente "${A.nombre}" creado correctamente`)}L(),B()}catch(s){x.error("Error: "+(s.message||(N?"Error al actualizar el paciente":"Error al crear el paciente")))}finally{h(!1)}}),className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),m.jsx("input",{type:"text",name:"nombre",value:A.nombre,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido *"}),m.jsx("input",{type:"text",name:"apellido",value:A.apellido,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Género"}),m.jsxs("select",{name:"genero",value:A.genero,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md",children:[m.jsx("option",{value:"masculino",children:"Masculino"}),m.jsx("option",{value:"femenino",children:"Femenino"}),m.jsx("option",{value:"otro",children:"Otro"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Nacimiento"}),m.jsx("input",{type:"date",name:"fecha_nacimiento",value:A.fecha_nacimiento,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documento"}),m.jsx("input",{type:"text",name:"documento",value:A.documento,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),m.jsx("input",{type:"email",name:"email",value:A.email,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nivel Educativo"}),m.jsx("input",{type:"text",name:"nivel_educativo",value:A.nivel_educativo,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ocupación"}),m.jsx("input",{type:"text",name:"ocupacion",value:A.ocupacion,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Institución *"}),m.jsxs("select",{name:"institucion_id",value:A.institucion_id,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md",required:!0,children:[m.jsx("option",{value:"",children:"Seleccione una institución"}),t.map(e=>m.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Psicólogo"}),m.jsxs("select",{name:"psicologo_id",value:A.psicologo_id,onChange:F,className:"w-full p-2 border border-gray-300 rounded-md",children:[m.jsx("option",{value:"",children:"Seleccione un psicólogo"}),i.map(e=>m.jsxs("option",{value:e.id,children:[e.nombre," ",e.apellido]},e.id))]})]})]}),m.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[m.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),m.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:n,children:n?m.jsxs(m.Fragment,{children:[m.jsx(u,{className:"animate-spin inline mr-2"}),"Guardando..."]}):N?"Actualizar":"Crear"})]})]})]})})]})},R=({onConnectionChange:e})=>{const[s,t]=d.useState(!1),[a,i]=d.useState("No probado"),[r,n]=d.useState([]),[u,p]=d.useState(""),[h,g]=d.useState([]),[b,f]=d.useState({status:"No probado",result:null,loading:!1}),[j,y]=d.useState({environment:null,database:null,functions:null,permissions:null});return d.useEffect(()=>{var e;u&&(e=u,c(null,null,function*(){if(e){t(!0);try{const{data:s,error:t}=yield S.from(e).select("*").limit(10);if(t)throw t;g(s||[]),x.success(`Datos de la tabla ${e} cargados correctamente`)}catch(s){x.error(`Error al cargar datos: ${s.message||"Desconocido"}`),g([])}finally{t(!1)}}}))},[u]),m.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[m.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Prueba de Conexión a Supabase"}),m.jsxs("div",{className:"mb-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"font-semibold",children:"Estado de la conexión:"}),m.jsx("span",{className:"px-3 py-1 rounded-full text-sm "+("Conectado"===a?"bg-green-100 text-green-800":"No probado"===a?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"),children:a})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:()=>c(null,null,function*(){t(!0);try{const t={supabaseUrl:"https://ydglduxhgwajqdseqzpy.supabase.co",hasAnonKey:!0,urlValid:"https://ydglduxhgwajqdseqzpy.supabase.co".includes("supabase.co"),status:"success"};t.supabaseUrl&&t.hasAnonKey||(t.status="error",t.message="Variables de entorno faltantes"),y(e=>o(l({},e),{environment:t}));let a={status:"checking"};try{const{data:e,error:s}=yield S.from("information_schema.columns").select("table_name").eq("table_schema","public").order("table_name");if(s)throw s;const t=[...new Set(e.map(e=>e.table_name))],r=t.map(e=>({name:e,schema:"public"}));a={status:"success",tablesCount:t.length,tables:r},n(r),i("Conectado")}catch(s){a={status:"error",error:s.message,code:s.code},i(`Error: ${s.message}`)}y(e=>o(l({},e),{database:a}));let r={status:"info",available:!0,message:"Verificación de funciones de conversión deshabilitada"};y(e=>o(l({},e),{functions:r}));let c={status:"checking"};try{const{data:e,error:s}=yield S.from("resultados").select("id").limit(1);if(s)throw s;c={status:"success",canRead:!0,message:"Permisos de lectura verificados"}}catch(s){c={status:"warning",canRead:!1,error:s.message,message:"Permisos limitados detectados"}}y(e=>o(l({},e),{permissions:c}));"success"===a.status&&"success"===r.status&&"success"===c.status?(x.success("✅ Todos los diagnósticos completados exitosamente"),e&&e(!0)):(x.warning("⚠️ Diagnósticos completados con advertencias"),e&&e("success"===a.status))}catch(s){x.error(`Error en diagnósticos: ${s.message}`),e&&e(!1)}finally{t(!1)}}),disabled:s,className:"flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300",children:s?"Ejecutando diagnósticos...":"Diagnósticos Completos"}),m.jsx("button",{onClick:()=>c(null,null,function*(){f(e=>o(l({},e),{loading:!0,status:"Probando..."}));try{const e=yield k.probarConversion(25,"V",13);e.success?(f({loading:!1,status:"Exitoso",result:{input:{pd:25,aptitud:"V",edad:13},output:{percentil:e.percentil},message:`PD 25 → PC ${e.percentil}`}}),x.success(`✅ Conversión exitosa: PC ${e.percentil}`)):(f({loading:!1,status:"Error",result:{error:e.error,validationErrors:e.validationErrors}}),x.error("❌ Error en conversión PD a PC"))}catch(e){f({loading:!1,status:"Error",result:{error:e.message}}),x.error(`❌ Error inesperado: ${e.message}`)}}),disabled:b.loading,className:"flex-1 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition-colors disabled:bg-green-300",children:b.loading?"Probando...":"Probar Conversión"})]})]}),Object.keys(j).length>0&&m.jsxs("div",{className:"mb-6 space-y-4",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Resultados de Diagnósticos"}),j.environment&&m.jsxs("div",{className:"p-4 rounded-lg border "+("success"===j.environment.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[m.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🔧 Variables de Entorno"}),m.jsxs("div",{className:"text-sm space-y-1",children:[m.jsxs("p",{children:["URL: ",j.environment.supabaseUrl||"No definida"]}),m.jsxs("p",{children:["Anon Key: ",j.environment.hasAnonKey?"✅ Definida":"❌ Faltante"]}),m.jsxs("p",{children:["URL Válida: ",j.environment.urlValid?"✅ Sí":"❌ No"]}),j.environment.message&&m.jsx("p",{className:"text-red-600",children:j.environment.message})]})]}),j.database&&m.jsxs("div",{className:"p-4 rounded-lg border "+("success"===j.database.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[m.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🗄️ Base de Datos"}),m.jsx("div",{className:"text-sm space-y-1",children:"success"===j.database.status?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"✅ Conexión exitosa"}),m.jsxs("p",{children:["Tablas encontradas: ",j.database.tablesCount]})]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"❌ Error de conexión"}),m.jsx("p",{className:"text-red-600",children:j.database.error}),j.database.code&&m.jsxs("p",{className:"text-red-500",children:["Código: ",j.database.code]})]})})]}),j.functions&&m.jsxs("div",{className:"p-4 rounded-lg border "+("success"===j.functions.status?"bg-green-50 border-green-200":"warning"===j.functions.status?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:[m.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"⚙️ Funciones de Conversión"}),m.jsxs("div",{className:"text-sm space-y-1",children:[m.jsxs("p",{children:[j.functions.available?"✅":"❌"," ",j.functions.message]}),j.functions.error&&m.jsx("p",{className:"text-red-600",children:j.functions.error})]})]}),j.permissions&&m.jsxs("div",{className:"p-4 rounded-lg border "+("success"===j.permissions.status?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[m.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🔐 Permisos"}),m.jsxs("div",{className:"text-sm space-y-1",children:[m.jsxs("p",{children:[j.permissions.canRead?"✅":"❌"," ",j.permissions.message]}),j.permissions.error&&m.jsx("p",{className:"text-yellow-600",children:j.permissions.error})]})]})]}),b.status&&"Pendiente"!==b.status&&m.jsxs("div",{className:"mb-6",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Prueba de Conversión PD→PC"}),m.jsx("div",{className:"p-4 rounded-lg border "+("Exitoso"===b.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:m.jsxs("div",{className:"text-sm space-y-2",children:[m.jsxs("p",{children:[m.jsx("strong",{children:"Estado:"})," ",b.status]}),b.result&&m.jsxs(m.Fragment,{children:[b.result.message&&m.jsx("p",{className:"text-green-700 font-medium",children:b.result.message}),b.result.input&&m.jsxs("p",{children:[m.jsx("strong",{children:"Entrada:"})," PD=",b.result.input.pd,", Aptitud=",b.result.input.aptitud,", Edad=",b.result.input.edad]}),b.result.output&&m.jsxs("p",{children:[m.jsx("strong",{children:"Resultado:"})," PC=",b.result.output.percentil]}),b.result.error&&m.jsxs("p",{className:"text-red-600",children:[m.jsx("strong",{children:"Error:"})," ",b.result.error]}),b.result.validationErrors&&m.jsxs("div",{className:"text-red-600",children:[m.jsx("strong",{children:"Errores de validación:"}),m.jsx("ul",{className:"list-disc list-inside ml-4",children:b.result.validationErrors.map((e,s)=>m.jsx("li",{children:e},s))})]})]})]})})]}),r.length>0&&m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar tabla:"}),m.jsxs("select",{value:u,onChange:e=>p(e.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3",disabled:s,children:[m.jsx("option",{value:"",children:"Seleccione una tabla"}),r.map(e=>m.jsx("option",{value:e.name,children:e.name},e.name))]})]}),h.length>0&&m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Datos de ",u]}),m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[m.jsx("thead",{className:"bg-gray-50",children:m.jsx("tr",{children:Object.keys(h[0]).map(e=>m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e},e))})}),m.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map((e,s)=>m.jsx("tr",{children:Object.values(e).map((e,s)=>m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:"object"==typeof e?JSON.stringify(e):String(e)},s))},s))})]})})]})]})},B=()=>{const[e,s]=d.useState(!1),[t,a]=d.useState(null),[i,r]=d.useState(!1),[n,u]=d.useState({puntajeDirecto:25,aptitudCodigo:"V",edad:13});d.useEffect(()=>{x()},[]);const x=()=>c(null,null,function*(){const e=yield k.obtenerEstadisticasConversion();a(e)});return m.jsxs("div",{className:"space-y-6",children:[m.jsxs(P,{children:[m.jsx(E,{children:m.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:[m.jsx("i",{className:"fas fa-cogs mr-2 text-blue-600"}),"Estado del Sistema de Conversión"]})}),m.jsx(D,{children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"w-3 h-3 rounded-full mr-3 "+(i?"bg-green-500":"bg-red-500")}),m.jsxs("span",{className:"text-sm",children:["Funciones de Supabase: ",i?"Disponibles":"No disponibles"]})]}),t&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"text-sm",children:[m.jsx("span",{className:"font-medium",children:"Total resultados:"})," ",t.totalResultados]}),m.jsxs("div",{className:"text-sm",children:[m.jsx("span",{className:"font-medium",children:"Con percentil:"})," ",t.conPercentil]}),m.jsxs("div",{className:"text-sm",children:[m.jsx("span",{className:"font-medium",children:"Sin percentil:"})," ",t.sinPercentil]}),m.jsxs("div",{className:"text-sm",children:[m.jsx("span",{className:"font-medium",children:"% Convertido:"})," ",t.porcentajeConvertido,"%"]})]})]})})]}),m.jsxs(P,{children:[m.jsx(E,{children:m.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:[m.jsx("i",{className:"fas fa-tools mr-2 text-green-600"}),"Acciones de Conversión"]})}),m.jsx(D,{children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs(I,{onClick:()=>c(null,null,function*(){s(!0);try{yield k.configurarConversionAutomatica(),yield x()}catch(e){}finally{s(!1)}}),disabled:e,variant:"primary",className:"w-full",children:[e?m.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):m.jsx("i",{className:"fas fa-play mr-2"}),"Configurar Conversión Automática"]}),m.jsxs(I,{onClick:()=>c(null,null,function*(){s(!0);try{yield k.recalcularTodosLosPercentiles(),yield x()}catch(e){}finally{s(!1)}}),disabled:e,variant:"secondary",className:"w-full",children:[e?m.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):m.jsx("i",{className:"fas fa-sync mr-2"}),"Recalcular Percentiles Existentes"]}),m.jsxs(I,{onClick:()=>c(null,null,function*(){s(!0);try{(yield k.verificarBaremos()).success&&alert("Baremos verificados correctamente. Ver consola para detalles.")}catch(e){}finally{s(!1)}}),disabled:e,variant:"outline",className:"w-full",children:[e?m.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):m.jsx("i",{className:"fas fa-check mr-2"}),"Verificar Baremos"]}),m.jsxs(I,{onClick:x,disabled:e,variant:"outline",className:"w-full",children:[e?m.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):m.jsx("i",{className:"fas fa-refresh mr-2"}),"Actualizar Estadísticas"]})]})})]}),m.jsxs(P,{children:[m.jsx(E,{children:m.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:[m.jsx("i",{className:"fas fa-flask mr-2 text-purple-600"}),"Probar Conversión PD → PC"]})}),m.jsxs(D,{children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Puntaje PD"}),m.jsx("input",{type:"number",value:n.puntajeDirecto,onChange:e=>u(o(l({},n),{puntajeDirecto:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",max:"100"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aptitud"}),m.jsxs("select",{value:n.aptitudCodigo,onChange:e=>u(o(l({},n),{aptitudCodigo:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"V",children:"V - Aptitud Verbal"}),m.jsx("option",{value:"E",children:"E - Aptitud Espacial"}),m.jsx("option",{value:"A",children:"A - Atención"}),m.jsx("option",{value:"R",children:"R - Razonamiento"}),m.jsx("option",{value:"N",children:"N - Aptitud Numérica"}),m.jsx("option",{value:"M",children:"M - Aptitud Mecánica"}),m.jsx("option",{value:"O",children:"O - Ortografía"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Edad"}),m.jsxs("select",{value:n.edad,onChange:e=>u(o(l({},n),{edad:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"12",children:"12 años"}),m.jsx("option",{value:"13",children:"13 años"}),m.jsx("option",{value:"14",children:"14 años"})]})]}),m.jsx("div",{className:"flex items-end",children:m.jsxs(I,{onClick:()=>c(null,null,function*(){s(!0);try{const e=yield k.probarConversion(parseInt(n.puntajeDirecto),n.aptitudCodigo,parseInt(n.edad));e.success?alert(`Conversión exitosa: PD ${n.puntajeDirecto} → PC ${e.percentil}`):alert("Error en la conversión")}catch(e){}finally{s(!1)}}),disabled:e,variant:"primary",className:"w-full",children:[e?m.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):m.jsx("i",{className:"fas fa-calculator mr-2"}),"Probar"]})})]}),m.jsx("div",{className:"text-sm text-gray-600",children:m.jsxs("p",{children:[m.jsx("strong",{children:"Ejemplo:"})," PD 25 en Aptitud Verbal para 13 años debería dar PC 50 aproximadamente"]})})]})]}),m.jsxs(P,{children:[m.jsx(E,{children:m.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:[m.jsx("i",{className:"fas fa-info-circle mr-2 text-blue-600"}),"Información del Sistema"]})}),m.jsx(D,{children:m.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[m.jsxs("p",{children:[m.jsx("strong",{children:"Conversión Automática:"})," Los nuevos resultados se convierten automáticamente usando triggers de Supabase."]}),m.jsxs("p",{children:[m.jsx("strong",{children:"Baremos:"})," Se utilizan las tablas de baremos para edades 12-13 y 13-14 años."]}),m.jsxs("p",{children:[m.jsx("strong",{children:"Recálculo:"})," Permite actualizar resultados existentes que no tienen percentil calculado."]}),m.jsxs("p",{children:[m.jsx("strong",{children:"Verificación:"})," Comprueba que las funciones y baremos estén correctamente configurados en Supabase."]})]})})]})]})},F=()=>{const[e,s]=d.useState("institutions"),[t,a]=d.useState(!0),[i,r]=d.useState(!1),n=y(),l=new URLSearchParams(n.search).get("tab");d.useEffect(()=>{l&&["institutions","psychologists","patients","supabase","conversion"].includes(l)&&s(l);return(()=>{let e=document.getElementById("modal-root");e||(e=document.createElement("div"),e.id="modal-root",document.body.appendChild(e),e.style.position="relative",e.style.zIndex="9999")})(),setTimeout(()=>{a(!1)},1e3),()=>{const e=document.getElementById("modal-root");e&&0===e.childElementCount&&document.body.removeChild(e)}},[l]);const o=e=>{s(e)};return t?m.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:[m.jsx(u,{className:"animate-spin text-blue-600 text-4xl mb-4"}),m.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Cargando Panel de Administración..."}),m.jsx("p",{className:"text-gray-500 mt-2",children:"Verificando permisos y cargando datos"})]}):m.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[m.jsx(_,{title:"Panel de Administración",subtitle:"Gestión centralizada de recursos de la plataforma",icon:v}),m.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:m.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[m.jsx("div",{className:"border-b border-gray-200",children:m.jsxs("nav",{className:"flex -mb-px",children:[m.jsx("button",{className:`px-4 py-4 text-center text-sm font-medium ${"institutions"===e?"border-b-2 border-blue-500 text-amber-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"} focus:outline-none transition-colors w-1/5`,onClick:()=>o("institutions"),children:m.jsxs("div",{className:"flex items-center justify-center",children:[m.jsx(h,{className:"mr-2"}),m.jsx("span",{children:"Instituciones"})]})}),m.jsx("button",{className:`px-4 py-4 text-center text-sm font-medium ${"psychologists"===e?"border-b-2 border-blue-500 text-amber-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"} focus:outline-none transition-colors w-1/5`,onClick:()=>o("psychologists"),children:m.jsxs("div",{className:"flex items-center justify-center",children:[m.jsx(N,{className:"mr-2"}),m.jsx("span",{children:"Psicólogos"})]})}),m.jsx("button",{className:`px-4 py-4 text-center text-sm font-medium ${"patients"===e?"border-b-2 border-blue-500 text-amber-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"} focus:outline-none transition-colors w-1/5`,onClick:()=>o("patients"),children:m.jsxs("div",{className:"flex items-center justify-center",children:[m.jsx(w,{className:"mr-2"}),m.jsx("span",{children:"Pacientes"})]})}),m.jsx("button",{className:`px-4 py-4 text-center text-sm font-medium ${"conversion"===e?"border-b-2 border-blue-500 text-green-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"} focus:outline-none transition-colors w-1/5`,onClick:()=>o("conversion"),children:m.jsxs("div",{className:"flex items-center justify-center",children:[m.jsx("i",{className:"fas fa-exchange-alt mr-2"}),m.jsx("span",{children:"Conversión PD→PC"})]})}),m.jsx("button",{className:`px-4 py-4 text-center text-sm font-medium ${"supabase"===e?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"} focus:outline-none transition-colors w-1/5`,onClick:()=>o("supabase"),children:m.jsxs("div",{className:"flex items-center justify-center",children:[m.jsx(C,{className:"mr-2"}),m.jsx("span",{children:"Supabase"})]})})]})}),m.jsx("div",{className:"p-6",children:(()=>{switch(e){case"institutions":default:return m.jsx(L,{});case"psychologists":return m.jsx(z,{});case"patients":return m.jsx($,{});case"supabase":return m.jsx(R,{onConnectionChange:r});case"conversion":return m.jsx(B,{})}})()})]})}),m.jsx("footer",{className:"bg-white border-t border-gray-200 py-8",children:m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:m.jsxs("p",{className:"text-center text-gray-500 text-sm",children:["© ",(new Date).getFullYear()," Sistema de Gestión Psicológica - Panel de Administración"]})})})]})};export{F as default};
